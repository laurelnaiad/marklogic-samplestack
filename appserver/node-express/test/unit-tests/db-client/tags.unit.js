/*
 * Copyright 2012-2015 MarkLogic Corporation
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
module.exports = function() {

  describe('tags',function() {

    var sandbox;
    var Promise = require('bluebird');
    var db = require('../../../lib/db-client');
    var connection = db.getGenericClient('admin','admin');
    var tags = require('../../../lib/db-client/tags')(connection);

    beforeEach(function () {
      sandbox = sinon.sandbox.create();
    });

    afterEach(function () {
      sandbox.restore();
    });

    it('getTags', function (done) {
      /* jshint ignore:start */
      var spec = {search:{qtext:[''],start:1,timezone:'America/Los_Angeles',pageLength:10,forTag:'acc',sort:'name'}};
      var docResult = {'values-response':{name:'tags',type:'xs:string','distinct-value':[{frequency:2,_value:'.each'},{frequency:2,_value:'.htaccess'},{frequency:2,_value:'.net'},{frequency:1,_value:'accented-strings'},{frequency:2,_value:'accessibility'},{frequency:1,_value:'accordion'},{frequency:2,_value:'acid'},{frequency:1,_value:'activexobject'},{frequency:1,_value:'ada'},{frequency:1,_value:'addclass'},{frequency:1,_value:'address-bar'},{frequency:1,_value:'admin'},{frequency:1,_value:'adobe-illustrator'},{frequency:1,_value:'adsense'},{frequency:1,_value:'aggregate'},{frequency:1,_value:'aggregate-functions'},{frequency:1,_value:'air'},{frequency:59,_value:'ajax'},{frequency:1,_value:'alert'},{frequency:1,_value:'alertdialog'},{frequency:1,_value:'altova'},{frequency:2,_value:'amazon-web-services'},{frequency:1,_value:'anchor'},{frequency:2,_value:'android'},{frequency:7,_value:'angularjs'},{frequency:1,_value:'animation'},{frequency:2,_value:'anonymous-function'},{frequency:1,_value:'anonymous-methods'},{frequency:1,_value:'any'},{frequency:3,_value:'apache'},{frequency:1,_value:'apache2'},{frequency:9,_value:'api'},{frequency:1,_value:'api-design'},{frequency:1,_value:'append'},{frequency:1,_value:'appendchild'},{frequency:1,_value:'appendto'},{frequency:1,_value:'architecture'},{frequency:3,_value:'arguments'},{frequency:1,_value:'arraylist'},{frequency:29,_value:'arrays'},{frequency:1,_value:'asp-classic'},{frequency:11,_value:'asp.net'},{frequency:1,_value:'asp.net-4.0'},{frequency:4,_value:'asp.net-mvc'},{frequency:1,_value:'asp.net-mvc-3'},{frequency:2,_value:'associative-array'},{frequency:1,_value:'async-await'},{frequency:9,_value:'asynchronous'},{frequency:1,_value:'auto-increment'},{frequency:1,_value:'axis2'},{frequency:3,_value:'backbone.js'},{frequency:1,_value:'background'},{frequency:2,_value:'basex'},{frequency:1,_value:'berkeley-db'},{frequency:1,_value:'berkeley-db-xml'},{frequency:1,_value:'bigdecimal'},{frequency:1,_value:'bing-maps'},{frequency:1,_value:'birt'},{frequency:2,_value:'bluebird'},{frequency:1,_value:'bnf'},{frequency:1,_value:'bookmarklet'},{frequency:1,_value:'boolean'},{frequency:1,_value:'boolean-expression'},{frequency:1,_value:'boolean-logic'},{frequency:1,_value:'branching-and-merging'},{frequency:7,_value:'browser'},{frequency:1,_value:'browser-cache'},{frequency:1,_value:'browser-detection'},{frequency:1,_value:'browser-history'},{frequency:1,_value:'button'},{frequency:1,_value:'c'},{frequency:5,_value:'c#'},{frequency:1,_value:'c#-4.0'},{frequency:1,_value:'c++'},{frequency:1,_value:'caching'},{frequency:1,_value:'call'},{frequency:4,_value:'callback'},{frequency:1,_value:'callstack'},{frequency:1,_value:'canjs'},{frequency:6,_value:'canvas'},{frequency:1,_value:'cdn'},{frequency:1,_value:'cell'},{frequency:1,_value:'centering'},{frequency:1,_value:'cgi'},{frequency:1,_value:'character-class'},{frequency:1,_value:'character-properties'},{frequency:5,_value:'checkbox'},{frequency:1,_value:'checked'},{frequency:4,_value:'class'},{frequency:1,_value:'class-dbi'},{frequency:1,_value:'classnotfoundexception'},{frequency:1,_value:'classpath'},{frequency:1,_value:'clear'},{frequency:1,_value:'cli'},{frequency:2,_value:'click'},{frequency:1,_value:'client-side'},{frequency:1,_value:'clipboard'},{frequency:1,_value:'clone'},{frequency:3,_value:'closures'},{frequency:1,_value:'code-formatting'},{frequency:1,_value:'code-organization'},{frequency:1,_value:'code-review'},{frequency:1,_value:'codeigniter'},{frequency:4,_value:'coding-style'},{frequency:1,_value:'coffeescript'},{frequency:1,_value:'coldfusion'},{frequency:1,_value:'colorbox'},{frequency:1,_value:'commenting'},{frequency:1,_value:'compare'},{frequency:1,_value:'compatibility'},{frequency:1,_value:'concurrency'},{frequency:1,_value:'condition'},{frequency:1,_value:'connection'},{frequency:1,_value:'connections'},{frequency:3,_value:'console'},{frequency:1,_value:'content-management-system'},{frequency:1,_value:'contenteditable'},{frequency:1,_value:'context'},{frequency:4,_value:'cookies'},{frequency:1,_value:'cordova'},{frequency:2,_value:'cors'},{frequency:1,_value:'count'},{frequency:1,_value:'cpan'},{frequency:1,_value:'createelement'},{frequency:1,_value:'cron'},{frequency:1,_value:'crontab'},{frequency:2,_value:'cross-browser'},{frequency:6,_value:'cross-domain'},{frequency:1,_value:'csh'},{frequency:39,_value:'css'},{frequency:1,_value:'css-float'},{frequency:1,_value:'css-selectors'},{frequency:2,_value:'css-transitions'},{frequency:3,_value:'css3'},{frequency:3,_value:'cts-search'},{frequency:2,_value:'curl'},{frequency:3,_value:'data'},{frequency:1,_value:'data-migration'},{frequency:1,_value:'data-virtualization'},{frequency:21,_value:'database'},{frequency:2,_value:'database-design'},{frequency:1,_value:'database-migration'},{frequency:3,_value:'date'},{frequency:1,_value:'date-comparison'},{frequency:2,_value:'datetime'},{frequency:1,_value:'db2'},{frequency:2,_value:'debugging'},{frequency:1,_value:'deferred'},{frequency:1,_value:'definition'},{frequency:1,_value:'delimiter'},{frequency:1,_value:'design'},{frequency:1,_value:'desktop'},{frequency:1,_value:'detect'},{frequency:1,_value:'dhtml'},{frequency:1,_value:'diacritics'},{frequency:1,_value:'difference'},{frequency:1,_value:'digit'},{frequency:1,_value:'directory-structure'},{frequency:1,_value:'disabled-input'},{frequency:1,_value:'distinct-values'},{frequency:5,_value:'django'},{frequency:1,_value:'django-csrf'},{frequency:1,_value:'django-testing'},{frequency:1,_value:'document'},{frequency:1,_value:'document-management'},{frequency:1,_value:'document-versioning'},{frequency:1,_value:'dojo'},{frequency:13,_value:'dom'},{frequency:1,_value:'domain-name'},{frequency:1,_value:'domcontentloaded'},{frequency:2,_value:'download'},{frequency:1,_value:'duplication'},{frequency:1,_value:'dvorak'},{frequency:1,_value:'dwr'},{frequency:1,_value:'dynamic'},{frequency:3,_value:'each'},{frequency:1,_value:'ebnf'},{frequency:3,_value:'eclipse'},{frequency:4,_value:'ecmascript-5'},{frequency:1,_value:'ecmascript-6'},{frequency:1,_value:'element'},{frequency:3,_value:'email'},{frequency:1,_value:'email-validation'},{frequency:1,_value:'encapsulation'},{frequency:1,_value:'encoding'},{frequency:1,_value:'enums'},{frequency:1,_value:'error-handling'},{frequency:1,_value:'error-logging'},{frequency:1,_value:'eval'},{frequency:2,_value:'event-handling'},{frequency:1,_value:'event-propagation'},{frequency:5,_value:'events'},{frequency:1,_value:'excel'},{frequency:1,_value:'exception'},{frequency:1,_value:'exception-handling'},{frequency:1,_value:'executable'},{frequency:1,_value:'execution'},{frequency:5,_value:'exist-db'},{frequency:1,_value:'expand'},{frequency:1,_value:'export'},{frequency:3,_value:'facebook'},{frequency:1,_value:'faceted-search'},{frequency:1,_value:'feature-detection'},{frequency:1,_value:'fetch'},{frequency:1,_value:'field'},{frequency:2,_value:'file'},{frequency:1,_value:'file-extension'},{frequency:1,_value:'filesystems'},{frequency:1,_value:'firebase'},{frequency:2,_value:'firebug'},{frequency:11,_value:'firefox'},{frequency:1,_value:'firefox-3'},{frequency:2,_value:'firefox-addon'},{frequency:1,_value:'floating-point'},{frequency:1,_value:'flwor'},{frequency:1,_value:'folder'},{frequency:1,_value:'font-size'},{frequency:3,_value:'for-loop'},{frequency:2,_value:'form-submit'},{frequency:1,_value:'form-validation'},{frequency:20,_value:'forms'},{frequency:1,_value:'frameworks'},{frequency:1,_value:'frontend'},{frequency:1,_value:'ftp'},{frequency:2,_value:'full-text-search'},{frequency:16,_value:'function'},{frequency:1,_value:'function-overloading'},{frequency:1,_value:'functional-programming'},{frequency:2,_value:'garbage-collection'},{frequency:1,_value:'geospatial'},{frequency:3,_value:'get'},{frequency:2,_value:'getelementbyid'},{frequency:2,_value:'getjson'},{frequency:1,_value:'gif'},{frequency:1,_value:'gis'},{frequency:1,_value:'gist'},{frequency:1,_value:'git'},{frequency:3,_value:'github'},{frequency:1,_value:'global'},{frequency:2,_value:'global-variables'},{frequency:1,_value:'google-apps-script'},{frequency:10,_value:'google-chrome'},{frequency:1,_value:'google-chrome-extension'},{frequency:1,_value:'google-maps'},{frequency:1,_value:'google-plus'},{frequency:1,_value:'google-spreadsheet'},{frequency:1,_value:'graphics'},{frequency:1,_value:'greasemonkey'},{frequency:1,_value:'group'},{frequency:1,_value:'gson'},{frequency:1,_value:'handlebars'},{frequency:1,_value:'handlebars.js'},{frequency:1,_value:'hash'},{frequency:1,_value:'header'},{frequency:1,_value:'height'},{frequency:1,_value:'hibernate'},{frequency:1,_value:'hiddenfield'},{frequency:1,_value:'hide'},{frequency:1,_value:'hoisting'},{frequency:1,_value:'href'},{frequency:130,_value:'html'},{frequency:1,_value:'html-entities'},{frequency:1,_value:'html-sanitizing'},{frequency:27,_value:'html5'},{frequency:1,_value:'html5-history'},{frequency:1,_value:'html5-video'},{frequency:1,_value:'htmltidy'},{frequency:2,_value:'http'},{frequency:2,_value:'http-headers'},{frequency:2,_value:'http-post'},{frequency:1,_value:'http-status-code-403'},{frequency:2,_value:'hyperlink'},{frequency:3,_value:'if-statement'},{frequency:8,_value:'iframe'},{frequency:1,_value:'iife'},{frequency:6,_value:'image'},{frequency:1,_value:'implementation'},{frequency:1,_value:'include'},{frequency:2,_value:'increment'},{frequency:1,_value:'index'},{frequency:1,_value:'indexes'},{frequency:1,_value:'indexof'},{frequency:1,_value:'infinite-loop'},{frequency:3,_value:'inheritance'},{frequency:2,_value:'innerhtml'},{frequency:1,_value:'innertext'},{frequency:1,_value:'innodb'},{frequency:2,_value:'input'},{frequency:1,_value:'input-field'},{frequency:1,_value:'insert'},{frequency:9,_value:'internet-explorer'},{frequency:4,_value:'internet-explorer-8'},{frequency:1,_value:'internet-explorer-9'},{frequency:1,_value:'ipad'},{frequency:1,_value:'iphone'},{frequency:1,_value:'iteration'},{frequency:1,_value:'iterator'},{frequency:1,_value:'iterparse'},{frequency:1,_value:'itext'},{frequency:2,_value:'jar'},{frequency:43,_value:'java'},{frequency:552,_value:'javascript'},{frequency:10,_value:'javascript-events'},{frequency:1,_value:'javascript-injection'},{frequency:1,_value:'jaxb'},{frequency:1,_value:'jboss'},{frequency:1,_value:'jira'},{frequency:298,_value:'jquery'},{frequency:1,_value:'jquery-1.6'},{frequency:1,_value:'jquery-callback'},{frequency:1,_value:'jquery-draggable'},{frequency:1,_value:'jquery-droppable'},{frequency:2,_value:'jquery-mobile'},{frequency:3,_value:'jquery-plugins'},{frequency:6,_value:'jquery-selectors'},{frequency:1,_value:'jquery-templates'},{frequency:4,_value:'jquery-ui'},{frequency:1,_value:'jquery-validate'},{frequency:1,_value:'jscolor'},{frequency:1,_value:'jsf'},{frequency:1,_value:'jslint'},{frequency:61,_value:'json'},{frequency:1,_value:'json-encode'},{frequency:2,_value:'jsonp'},{frequency:3,_value:'jsp'},{frequency:1,_value:'jsr'},{frequency:1,_value:'jsr223'},{frequency:1,_value:'jsr286'},{frequency:1,_value:'jsrender'},{frequency:1,_value:'jsviews'},{frequency:1,_value:'key-value'},{frequency:1,_value:'keyboard-layout'},{frequency:1,_value:'knockout-mapping-plugin'},{frequency:1,_value:'knockout.js'},{frequency:2,_value:'label'},{frequency:1,_value:'language-agnostic'},{frequency:1,_value:'libxml2'},{frequency:1,_value:'line-breaks'},{frequency:1,_value:'linkedin'},{frequency:3,_value:'linux'},{frequency:1,_value:'list'},{frequency:1,_value:'load'},{frequency:2,_value:'loading'},{frequency:1,_value:'local-storage'},{frequency:1,_value:'localhost'},{frequency:1,_value:'lodash'},{frequency:1,_value:'logstash'},{frequency:1,_value:'long-polling'},{frequency:4,_value:'loops'},{frequency:1,_value:'lxml'},{frequency:2,_value:'mailto'},{frequency:1,_value:'main'},{frequency:1,_value:'manipulation'},{frequency:2,_value:'map'},{frequency:1,_value:'mapping'},{frequency:1,_value:'markdown'},{frequency:1,_value:'marker'},{frequency:142,_value:'marklogic'},{frequency:2,_value:'match'},{frequency:3,_value:'math'},{frequency:1,_value:'mathjs'},{frequency:1,_value:'mediawiki'},{frequency:2,_value:'memory'},{frequency:1,_value:'memory-leaks'},{frequency:1,_value:'message-queue'},{frequency:2,_value:'metadata'},{frequency:1,_value:'method-overloading'},{frequency:3,_value:'methods'},{frequency:1,_value:'mime-types'},{frequency:2,_value:'mobile'},{frequency:2,_value:'module'},{frequency:5,_value:'mongodb'},{frequency:1,_value:'mouseevent'},{frequency:1,_value:'mouseover'},{frequency:1,_value:'ms-word'},{frequency:2,_value:'multidimensional-array'},{frequency:1,_value:'multipartform-data'},{frequency:4,_value:'multithreading'},{frequency:1,_value:'mutable'},{frequency:1,_value:'mvvm'},{frequency:21,_value:'mysql'},{frequency:1,_value:'namespaces'},{frequency:1,_value:'naming-conventions'},{frequency:1,_value:'native'},{frequency:1,_value:'navigation'},{frequency:1,_value:'nested'},{frequency:1,_value:'newline'},{frequency:1,_value:'node-mysql'},{frequency:19,_value:'node.js'},{frequency:1,_value:'non-relational-database'},{frequency:1,_value:'norm'},{frequency:11,_value:'nosql'},{frequency:1,_value:'nosuchmethod'},{frequency:1,_value:'null'},{frequency:1,_value:'number-formatting'},{frequency:1,_value:'number-manipulation'},{frequency:1,_value:'oauth'},{frequency:1,_value:'obfuscation'},{frequency:14,_value:'object'},{frequency:1,_value:'object-literal'},{frequency:1,_value:'objective-c'},{frequency:1,_value:'odt'},{frequency:1,_value:'onload'},{frequency:2,_value:'onmouseout'},{frequency:1,_value:'onmouseover'},{frequency:1,_value:'onsubmit'},{frequency:9,_value:'oop'},{frequency:1,_value:'oracle-apex'},{frequency:1,_value:'orbeon'},{frequency:2,_value:'orm'},{frequency:1,_value:'outlook'},{frequency:1,_value:'overflow'},{frequency:1,_value:'overloading'},{frequency:1,_value:'override'},{frequency:1,_value:'pagination'},{frequency:1,_value:'paging'},{frequency:1,_value:'parameterization'},{frequency:2,_value:'parameters'},{frequency:1,_value:'parent'},{frequency:1,_value:'parsefloat'},{frequency:4,_value:'parsing'},{frequency:1,_value:'paste'},{frequency:1,_value:'path'},{frequency:1,_value:'pattern-matching'},{frequency:1,_value:'pcre'},{frequency:1,_value:'pdf'},{frequency:1,_value:'pdf-manipulation'},{frequency:1,_value:'pdo'},{frequency:10,_value:'performance'},{frequency:9,_value:'perl'},{frequency:2,_value:'permissions'},{frequency:2,_value:'phonegap'},{frequency:91,_value:'php'},{frequency:1,_value:'phpmyadmin'},{frequency:1,_value:'plugins'},{frequency:1,_value:'polymorphism'},{frequency:2,_value:'popup'},{frequency:3,_value:'post'},{frequency:1,_value:'postmessage'},{frequency:1,_value:'predicate'},{frequency:2,_value:'preg-match'},{frequency:1,_value:'preg-replace'},{frequency:1,_value:'preview'},{frequency:1,_value:'private'},{frequency:1,_value:'procedural'},{frequency:1,_value:'programming-languages'},{frequency:1,_value:'progress-bar'},{frequency:5,_value:'promise'},{frequency:2,_value:'properties'},{frequency:2,_value:'prototypal-inheritance'},{frequency:4,_value:'prototype'},{frequency:1,_value:'prototype-programming'},{frequency:1,_value:'prototypejs'},{frequency:1,_value:'proximity'},{frequency:1,_value:'pseudo-class'},{frequency:1,_value:'publish'},{frequency:1,_value:'publish-subscribe'},{frequency:1,_value:'pull-request'},{frequency:7,_value:'python'},{frequency:1,_value:'python-requests'},{frequency:1,_value:'q'},{frequency:1,_value:'query-performance'},{frequency:1,_value:'query-string'},{frequency:1,_value:'quotes'},{frequency:1,_value:'qwerty'},{frequency:1,_value:'radio-button'},{frequency:2,_value:'raspberry-pi'},{frequency:1,_value:'rdf'},{frequency:1,_value:'react-jsx'},{frequency:1,_value:'reactive-programming'},{frequency:2,_value:'recursion'},{frequency:1,_value:'redirect'},{frequency:2,_value:'reference'},{frequency:29,_value:'regex'},{frequency:1,_value:'regex-negation'},{frequency:1,_value:'remote-access'},{frequency:3,_value:'replace'},{frequency:1,_value:'requestanimationframe'},{frequency:2,_value:'requirejs'},{frequency:1,_value:'reserved'},{frequency:1,_value:'reserved-words'},{frequency:2,_value:'reset'},{frequency:8,_value:'rest'},{frequency:1,_value:'rethinkdb'},{frequency:2,_value:'return'},{frequency:1,_value:'return-value'},{frequency:1,_value:'rotation'},{frequency:1,_value:'ruby'},{frequency:4,_value:'ruby-on-rails'},{frequency:2,_value:'ruby-on-rails-3'},{frequency:1,_value:'ruby-on-rails-4'},{frequency:1,_value:'runtimeexception'},{frequency:1,_value:'safari'},{frequency:1,_value:'sanitization'},{frequency:1,_value:'savefiledialog'},{frequency:3,_value:'saxon'},{frequency:1,_value:'scalability'},{frequency:1,_value:'scaling'},{frequency:12,_value:'scope'},{frequency:1,_value:'screen-readers'},{frequency:1,_value:'script-tag'},{frequency:2,_value:'scroll'},{frequency:9,_value:'search'},{frequency:6,_value:'security'},{frequency:1,_value:'seed-data'},{frequency:1,_value:'select'},{frequency:1,_value:'selector'},{frequency:1,_value:'selenium'},{frequency:1,_value:'selenium-webdriver'},{frequency:1,_value:'selenium2'},{frequency:2,_value:'semantic-web'},{frequency:1,_value:'semicolon'},{frequency:1,_value:'seo'},{frequency:1,_value:'serial-port'},{frequency:1,_value:'servlets'},{frequency:1,_value:'session-cookies'},{frequency:2,_value:'setinterval'},{frequency:1,_value:'settimeout'},{frequency:1,_value:'sha1'},{frequency:1,_value:'shell'},{frequency:1,_value:'shorthand'},{frequency:2,_value:'show-hide'},{frequency:1,_value:'singleton'},{frequency:1,_value:'sleep'},{frequency:1,_value:'soapui'},{frequency:1,_value:'socket.io'},{frequency:1,_value:'sockets'},{frequency:3,_value:'sorting'},{frequency:2,_value:'sparql'},{frequency:1,_value:'splash-screen'},{frequency:2,_value:'split'},{frequency:2,_value:'spring-mvc'},{frequency:1,_value:'spring-security'},{frequency:8,_value:'sql'},{frequency:1,_value:'sql-server'},{frequency:1,_value:'src'},{frequency:2,_value:'ssl'},{frequency:1,_value:'stack'},{frequency:1,_value:'standards'},{frequency:1,_value:'storage'},{frequency:1,_value:'stored-procedures'},{frequency:1,_value:'stream'},{frequency:3,_value:'string'},{frequency:1,_value:'string-concatenation'},{frequency:1,_value:'structure'},{frequency:1,_value:'struts2'},{frequency:1,_value:'styling'},{frequency:1,_value:'sublimetext2'},{frequency:2,_value:'submit'},{frequency:1,_value:'substring'},{frequency:1,_value:'sync'},{frequency:3,_value:'syntax'},{frequency:1,_value:'syntax-error'},{frequency:1,_value:'syntax-highlighting'},{frequency:5,_value:'table'},{frequency:1,_value:'tags'},{frequency:1,_value:'tail'},{frequency:1,_value:'tcp'},{frequency:1,_value:'terminology'},{frequency:2,_value:'text'},{frequency:1,_value:'text-files'},{frequency:1,_value:'textarea'},{frequency:2,_value:'this'},{frequency:1,_value:'time'},{frequency:1,_value:'timer'},{frequency:1,_value:'title'},{frequency:1,_value:'to-json'},{frequency:2,_value:'tomcat'},{frequency:2,_value:'transactions'},{frequency:1,_value:'transform'},{frequency:1,_value:'trigonometry'},{frequency:1,_value:'trim'},{frequency:1,_value:'triplestore'},{frequency:1,_value:'twitter'},{frequency:1,_value:'twitter-bootstrap'},{frequency:2,_value:'typeerror'},{frequency:1,_value:'typography'},{frequency:1,_value:'ubuntu'},{frequency:1,_value:'undefined'},{frequency:1,_value:'undefined-behavior'},{frequency:2,_value:'underscore.js'},{frequency:1,_value:'unicode'},{frequency:1,_value:'unit-testing'},{frequency:1,_value:'updating'},{frequency:3,_value:'upload'},{frequency:1,_value:'uri'},{frequency:6,_value:'url'},{frequency:1,_value:'url-parameters'},{frequency:1,_value:'url-rewriting'},{frequency:1,_value:'use-strict'},{frequency:1,_value:'user-controls'},{frequency:1,_value:'vagrant'},{frequency:3,_value:'validation'},{frequency:1,_value:'var'},{frequency:1,_value:'variable-scope'},{frequency:8,_value:'variables'},{frequency:2,_value:'vb.net'},{frequency:1,_value:'version-control'},{frequency:1,_value:'versioning'},{frequency:1,_value:'virtualization'},{frequency:1,_value:'virus'},{frequency:1,_value:'w3c'},{frequency:1,_value:'w3c-validation'},{frequency:1,_value:'war'},{frequency:1,_value:'wcf'},{frequency:1,_value:'web'},{frequency:2,_value:'web-applications'},{frequency:1,_value:'web-audio'},{frequency:1,_value:'web-browser'},{frequency:1,_value:'web-development-server'},{frequency:1,_value:'web-hosting'},{frequency:1,_value:'web-security'},{frequency:3,_value:'web-services'},{frequency:1,_value:'web-standards'},{frequency:1,_value:'web-worker'},{frequency:1,_value:'webforms'},{frequency:1,_value:'webgl'},{frequency:2,_value:'webserver'},{frequency:1,_value:'website'},{frequency:2,_value:'websocket'},{frequency:1,_value:'while-loop'},{frequency:1,_value:'whitespace'},{frequency:1,_value:'width'},{frequency:2,_value:'wildcard'},{frequency:1,_value:'window'},{frequency:1,_value:'window.opener'},{frequency:1,_value:'windows-phone-8'},{frequency:1,_value:'word'},{frequency:1,_value:'wpf'},{frequency:7,_value:'xhtml'},{frequency:1,_value:'xhtml-1.0-strict'},{frequency:1,_value:'xinclude'},{frequency:48,_value:'xml'},{frequency:1,_value:'xml-attribute'},{frequency:1,_value:'xml-libxml'},{frequency:2,_value:'xml-namespaces'},{frequency:2,_value:'xml-parsing'},{frequency:4,_value:'xml-schema'},{frequency:1,_value:'xmlhttprequest'},{frequency:1,_value:'xmlspy'},{frequency:13,_value:'xpath'},{frequency:2,_value:'xpath-2.0'},{frequency:1,_value:'xpointer'},{frequency:71,_value:'xquery'},{frequency:1,_value:'xquery-update'},{frequency:2,_value:'xsd'},{frequency:3,_value:'xslt'},{frequency:2,_value:'xss'},{frequency:1,_value:'xss-prevention'},{frequency:1,_value:'yahoo'},{frequency:1,_value:'youtube'},{frequency:1,_value:'yui'}],'aggregate-result':[{name:'count',_value:'2815'}],metrics:{'values-resolution-time':'PT0.017104S','aggregate-resolution-time':'PT0.001282S','total-time':'PT0.197821S'}}};
      var ret = {'values-response':{name:'tags',type:'xs:string','distinct-value':[{frequency:2,_value:'.htaccess'},{frequency:1,_value:'accented-strings'},{frequency:2,_value:'accessibility'},{frequency:1,_value:'accordion'},{frequency:1,_value:'remote-access'}],'aggregate-result':[{name:'count',_value:'2815'}],metrics:{'values-resolution-time':'PT0.017104S','aggregate-resolution-time':'PT0.001282S','total-time':'PT0.197821S'},total:5}};
      /* jshint ignore:end */

      sandbox.stub(connection.documents, 'query', function(sp) {
        sp.should.deep.equal(spec);
        return {
          result: function() {
            return Promise.resolve(docResult);
          }
        };
      });

      tags.getTags(spec).then(function(gtRet) {
        gtRet.should.deep.equal(ret);
        done();
      });

    });


    it('getRelatedTags', function (done) {
      /* jshint ignore:start */
      var spec = {search:{qtext:[''],start:1,timezone:'America/Los_Angeles',pageLength:100,relatedTo:'json',sort:'frequency'}};
      var getResult = [{contentType:'application/json',format:'json',contentLength:'711',content:{reltags:['aiml','ajax4jsf','angularjs','bson','base64','bookmarklet','commonjs','coolite','dgml','dxl','delimiter','dhtmlx','docbook','exslt','ebxml','ember.js','fxml','gson','graphml','html','html5','hijax','icefaces','idoc','jquery','json-ld','json-rpc','jsonp','javascript','javascriptmvc','jsonml','kxml','lpod','mathml','messagepack','mootools','morfik','opendocument','openlaszlo','qooxdoo','riak','s-expression','soap','sxml','sajax','serialization','smartclient','spreadsheetml','sproutcore','voicexml','wai-aria','wddx','wavemaker','xbl','xfa','xhtml','xlink','xml','xmlhttprequest','xproc','xslt','xulrunner','xajax','yaml','zimbra']}}];
      var querySpec = {search:{qtext:['','tag:aiml OR tag:ajax4jsf OR tag:angularjs OR tag:bson OR tag:base64 OR tag:bookmarklet OR tag:commonjs OR tag:coolite OR tag:dgml OR tag:dxl OR tag:delimiter OR tag:dhtmlx OR tag:docbook OR tag:exslt OR tag:ebxml OR tag:ember.js OR tag:fxml OR tag:gson OR tag:graphml OR tag:html OR tag:html5 OR tag:hijax OR tag:icefaces OR tag:idoc OR tag:jquery OR tag:json-ld OR tag:json-rpc OR tag:jsonp OR tag:javascript OR tag:javascriptmvc OR tag:jsonml OR tag:kxml OR tag:lpod OR tag:mathml OR tag:messagepack OR tag:mootools OR tag:morfik OR tag:opendocument OR tag:openlaszlo OR tag:qooxdoo OR tag:riak OR tag:s-expression OR tag:soap OR tag:sxml OR tag:sajax OR tag:serialization OR tag:smartclient OR tag:spreadsheetml OR tag:sproutcore OR tag:voicexml OR tag:wai-aria OR tag:wddx OR tag:wavemaker OR tag:xbl OR tag:xfa OR tag:xhtml OR tag:xlink OR tag:xml OR tag:xmlhttprequest OR tag:xproc OR tag:xslt OR tag:xulrunner OR tag:xajax OR tag:yaml OR tag:zimbra'],timezone:'America/Los_Angeles',relatedTo:'json',options:{values:{range:{type:'xs:string','json-property':'tags'},name:'tags','values-option':'frequency-order'}}}};
      var queryResult = {'values-response':{name:'tags',type:'xs:string','distinct-value':[{frequency:1557,_value:'javascript'},{frequency:987,_value:'jquery'},{frequency:372,_value:'html'},{frequency:151,_value:'xml'},{frequency:149,_value:'ajax'},{frequency:128,_value:'php'},{frequency:127,_value:'css'},{frequency:117,_value:'json'},{frequency:81,_value:'xquery'},{frequency:72,_value:'marklogic'},{frequency:69,_value:'arrays'},{frequency:47,_value:'regex'},{frequency:45,_value:'html5'},{frequency:44,_value:'dom'},{frequency:42,_value:'forms'},{frequency:36,_value:'function'},{frequency:36,_value:'node.js'},{frequency:32,_value:'internet-explorer'},{frequency:30,_value:'asp.net'},{frequency:28,_value:'java'},{frequency:26,_value:'object'},{frequency:24,_value:'firefox'},{frequency:23,_value:'google-chrome'},{frequency:23,_value:'javascript-events'},{frequency:22,_value:'database'},{frequency:21,_value:'xpath'},{frequency:20,_value:'iframe'},{frequency:20,_value:'scope'},{frequency:19,_value:'xslt'},{frequency:18,_value:'image'},{frequency:18,_value:'performance'},{frequency:17,_value:'angularjs'},{frequency:16,_value:'checkbox'},{frequency:16,_value:'events'},{frequency:16,_value:'jquery-selectors'},{frequency:15,_value:'oop'},{frequency:14,_value:'variables'},{frequency:14,_value:'xhtml'},{frequency:13,_value:'asynchronous'},{frequency:13,_value:'jquery-ui'},{frequency:12,_value:'browser'},{frequency:12,_value:'canvas'},{frequency:12,_value:'post'},{frequency:12,_value:'string'},{frequency:11,_value:'c#'},{frequency:11,_value:'callback'},{frequency:11,_value:'class'},{frequency:11,_value:'input'},{frequency:11,_value:'jquery-plugins'},{frequency:10,_value:'click'},{frequency:10,_value:'if-statement'},{frequency:10,_value:'loops'},{frequency:10,_value:'mysql'},{frequency:10,_value:'table'},{frequency:9,_value:'for-loop'},{frequency:9,_value:'internet-explorer-8'},{frequency:9,_value:'promise'},{frequency:9,_value:'sorting'},{frequency:9,_value:'url'},{frequency:9,_value:'validation'},{frequency:8,_value:'cookies'},{frequency:8,_value:'cross-domain'},{frequency:8,_value:'onclick'},{frequency:8,_value:'replace'},{frequency:8,_value:'setinterval'},{frequency:8,_value:'syntax'},{frequency:8,_value:'twitter-bootstrap'},{frequency:7,_value:'animation'},{frequency:7,_value:'append'},{frequency:7,_value:'css3'},{frequency:7,_value:'event-handling'},{frequency:7,_value:'jsonp'},{frequency:7,_value:'jsp'},{frequency:7,_value:'prototype'},{frequency:7,_value:'security'},{frequency:7,_value:'select'},{frequency:7,_value:'this'},{frequency:6,_value:'api'},{frequency:6,_value:'asp.net-mvc'},{frequency:6,_value:'autocomplete'},{frequency:6,_value:'closures'},{frequency:6,_value:'date'},{frequency:6,_value:'each'},{frequency:6,_value:'exist-db'},{frequency:6,_value:'inheritance'},{frequency:6,_value:'jquery-animate'},{frequency:6,_value:'methods'},{frequency:6,_value:'parsing'},{frequency:6,_value:'ruby-on-rails'},{frequency:6,_value:'timer'},{frequency:6,_value:'underscore.js'},{frequency:6,_value:'wordpress'},{frequency:5,_value:'associative-array'},{frequency:5,_value:'backbone.js'},{frequency:5,_value:'facebook'},{frequency:5,_value:'firefox-addon'},{frequency:5,_value:'jquery-validate'},{frequency:5,_value:'popup'},{frequency:5,_value:'python'},{frequency:5,_value:'settimeout'},{frequency:5,_value:'split'},{frequency:5,_value:'sql'},{frequency:5,_value:'templates'},{frequency:5,_value:'toggle'},{frequency:5,_value:'undefined'},{frequency:5,_value:'xmlhttprequest'},{frequency:4,_value:'.net'},{frequency:4,_value:'alert'},{frequency:4,_value:'anonymous-function'},{frequency:4,_value:'asp-classic'},{frequency:4,_value:'bluebird'},{frequency:4,_value:'button'},{frequency:4,_value:'coding-style'},{frequency:4,_value:'cross-browser'},{frequency:4,_value:'d3.js'},{frequency:4,_value:'datepicker'},{frequency:4,_value:'datetime'},{frequency:4,_value:'debugging'},{frequency:4,_value:'dynamic'},{frequency:4,_value:'ecmascript-5'},{frequency:4,_value:'element'},{frequency:4,_value:'error-handling'},{frequency:4,_value:'file'},{frequency:4,_value:'form-submit'},{frequency:4,_value:'getelementbyid'},{frequency:4,_value:'html-select'},{frequency:4,_value:'http'},{frequency:4,_value:'hyperlink'},{frequency:4,_value:'jquery-deferred'},{frequency:4,_value:'jquery-mobile'},{frequency:4,_value:'jslint'},{frequency:4,_value:'match'},{frequency:4,_value:'math'},{frequency:4,_value:'multidimensional-array'},{frequency:4,_value:'nan'},{frequency:4,_value:'navigation'},{frequency:4,_value:'nested'},{frequency:4,_value:'onload'},{frequency:4,_value:'properties'},{frequency:4,_value:'prototypejs'},{frequency:4,_value:'reference'},{frequency:4,_value:'safari'},{frequency:4,_value:'search'},{frequency:4,_value:'selector'},{frequency:4,_value:'servlets'},{frequency:4,_value:'syntax-error'},{frequency:4,_value:'text'},{frequency:4,_value:'webforms'},{frequency:3,_value:'addclass'},{frequency:3,_value:'anchor'},{frequency:3,_value:'arguments'},{frequency:3,_value:'asp.net-mvc-3'},{frequency:3,_value:'bind'},{frequency:3,_value:'bookmarklet'},{frequency:3,_value:'call'},{frequency:3,_value:'clipboard'},{frequency:3,_value:'codeigniter'},{frequency:3,_value:'django'},{frequency:3,_value:'eclipse'},{frequency:3,_value:'encoding'},{frequency:3,_value:'fadein'},{frequency:3,_value:'file-upload'},{frequency:3,_value:'garbage-collection'},{frequency:3,_value:'get'},{frequency:3,_value:'global-variables'},{frequency:3,_value:'google-chrome-extension'},{frequency:3,_value:'google-maps'},{frequency:3,_value:'greasemonkey'},{frequency:3,_value:'height'},{frequency:3,_value:'hover'},{frequency:3,_value:'internet-explorer-7'},{frequency:3,_value:'internet-explorer-9'},{frequency:3,_value:'ios'},{frequency:3,_value:'ipad'},{frequency:3,_value:'jquery-callback'},{frequency:3,_value:'mailto'},{frequency:3,_value:'map'},{frequency:3,_value:'markdown'},{frequency:3,_value:'memory-leaks'},{frequency:3,_value:'mobile'},{frequency:3,_value:'mouseevent'},{frequency:3,_value:'nosql'},{frequency:3,_value:'onchange'},{frequency:3,_value:'onerror'},{frequency:3,_value:'pdf'},{frequency:3,_value:'push'},{frequency:3,_value:'random'},{frequency:3,_value:'requirejs'},{frequency:3,_value:'reset'},{frequency:3,_value:'return'},{frequency:3,_value:'scroll'},{frequency:3,_value:'show-hide'},{frequency:3,_value:'submit'},{frequency:3,_value:'substring'},{frequency:3,_value:'tags'},{frequency:3,_value:'textbox'},{frequency:3,_value:'var'},{frequency:3,_value:'vb.net'},{frequency:3,_value:'w3c'},{frequency:3,_value:'web'},{frequency:3,_value:'web-applications'},{frequency:3,_value:'websocket'},{frequency:3,_value:'xml-parsing'},{frequency:3,_value:'xss'},{frequency:2,_value:'.each'},{frequency:2,_value:'.post'},{frequency:2,_value:'accessibility'},{frequency:2,_value:'add'},{frequency:2,_value:'apache'},{frequency:2,_value:'asp.net-ajax'},{frequency:2,_value:'background'},{frequency:2,_value:'background-color'},{frequency:2,_value:'base64'},{frequency:2,_value:'boolean'},{frequency:2,_value:'c++'},{frequency:2,_value:'caching'},{frequency:2,_value:'cdata'},{frequency:2,_value:'colorbox'},{frequency:2,_value:'colors'},{frequency:2,_value:'console'},{frequency:2,_value:'constants'},{frequency:2,_value:'context'},{frequency:2,_value:'copy'},{frequency:2,_value:'cordova'},{frequency:2,_value:'count'},{frequency:2,_value:'css-selectors'},{frequency:2,_value:'css-transitions'},{frequency:2,_value:'cts-search'},{frequency:2,_value:'data'},{frequency:2,_value:'database-design'},{frequency:2,_value:'deferred'},{frequency:2,_value:'delete'},{frequency:2,_value:'design'},{frequency:2,_value:'detect'},{frequency:2,_value:'disabled-input'},{frequency:2,_value:'document'},{frequency:2,_value:'drop-down-menu'},{frequency:2,_value:'dry'},{frequency:2,_value:'dynamic-arrays'},{frequency:2,_value:'ecmascript-6'},{frequency:2,_value:'eval'},{frequency:2,_value:'event-bubbling'},{frequency:2,_value:'fade'},{frequency:2,_value:'fadeout'},{frequency:2,_value:'fancybox'},{frequency:2,_value:'firebug'},{frequency:2,_value:'focus'},{frequency:2,_value:'foreach'},{frequency:2,_value:'frameworks'},{frequency:2,_value:'freeze'},{frequency:2,_value:'frontend'},{frequency:2,_value:'full-text-search'},{frequency:2,_value:'generator'},{frequency:2,_value:'getjson'},{frequency:2,_value:'gif'},{frequency:2,_value:'google-analytics'},{frequency:2,_value:'google-maps-api-3'},{frequency:2,_value:'google-plus'},{frequency:2,_value:'google-visualization'},{frequency:2,_value:'graphics'},{frequency:2,_value:'gson'},{frequency:2,_value:'gwt'},{frequency:2,_value:'hide'},{frequency:2,_value:'html-form'},{frequency:2,_value:'html-lists'},{frequency:2,_value:'http-headers'},{frequency:2,_value:'http-status-code-403'},{frequency:2,_value:'https'},{frequency:2,_value:'iife'},{frequency:2,_value:'include'},{frequency:2,_value:'increment'},{frequency:2,_value:'infinite-loop'},{frequency:2,_value:'innerhtml'},{frequency:2,_value:'insert'},{frequency:2,_value:'iteration'},{frequency:2,_value:'iterator'},{frequency:2,_value:'jquery-1.6'},{frequency:2,_value:'kendo-ui'},{frequency:2,_value:'keypress'},{frequency:2,_value:'knockout.js'},{frequency:2,_value:'label'},{frequency:2,_value:'load'},{frequency:2,_value:'loading'},{frequency:2,_value:'local-storage'},{frequency:2,_value:'marquee'},{frequency:2,_value:'memory'},{frequency:2,_value:'meta-tags'},{frequency:2,_value:'module'},{frequency:2,_value:'multipartform-data'},{frequency:2,_value:'multiple-instances'},{frequency:2,_value:'multithreading'},{frequency:2,_value:'namespaces'},{frequency:2,_value:'native'},{frequency:2,_value:'new-operator'},{frequency:2,_value:'next'},{frequency:2,_value:'obfuscation'},{frequency:2,_value:'onmouseout'},{frequency:2,_value:'onsubmit'},{frequency:2,_value:'opera'},{frequency:2,_value:'optimization'},{frequency:2,_value:'parameter-passing'},{frequency:2,_value:'parameters'},{frequency:2,_value:'parent'},{frequency:2,_value:'parsefloat'},{frequency:2,_value:'perl'},{frequency:2,_value:'phonegap'},{frequency:2,_value:'photoshop'},{frequency:2,_value:'preventdefault'},{frequency:2,_value:'progress-bar'},{frequency:2,_value:'prototypal-inheritance'},{frequency:2,_value:'pseudo-class'},{frequency:2,_value:'quotes'},{frequency:2,_value:'recursion'},{frequency:2,_value:'redirect'},{frequency:2,_value:'replacewith'},{frequency:2,_value:'rest'},{frequency:2,_value:'return-value'},{frequency:2,_value:'ruby-on-rails-3'},{frequency:2,_value:'saxon'},{frequency:2,_value:'script-tag'},{frequency:2,_value:'scrolling'},{frequency:2,_value:'seed-data'},{frequency:2,_value:'singleton'},{frequency:2,_value:'spring'},{frequency:2,_value:'ssl'},{frequency:2,_value:'struts2'},{frequency:2,_value:'stylesheet'},{frequency:2,_value:'synchronization'},{frequency:2,_value:'textarea'},{frequency:2,_value:'timeout'},{frequency:2,_value:'tooltip'},{frequency:2,_value:'touch'},{frequency:2,_value:'triggers'},{frequency:2,_value:'typeerror'},{frequency:2,_value:'unicode'},{frequency:2,_value:'upload'},{frequency:2,_value:'user-interface'},{frequency:2,_value:'variable-scope'},{frequency:2,_value:'video'},{frequency:2,_value:'w3c-validation'},{frequency:2,_value:'web-browser'},{frequency:2,_value:'web-scraping'},{frequency:2,_value:'web-services'},{frequency:2,_value:'web-standards'},{frequency:2,_value:'website'},{frequency:2,_value:'while-loop'},{frequency:2,_value:'whitespace'},{frequency:2,_value:'window.opener'},{frequency:2,_value:'x-frame-options'},{frequency:2,_value:'xml-namespaces'},{frequency:2,_value:'xml-schema'},{frequency:2,_value:'xmldom'},{frequency:2,_value:'xsd'},{frequency:1,_value:'.net-3.5'},{frequency:1,_value:'32bit-64bit'},{frequency:1,_value:'accented-strings'},{frequency:1,_value:'accordion'},{frequency:1,_value:'active'},{frequency:1,_value:'activex'},{frequency:1,_value:'activexobject'},{frequency:1,_value:'addeventlistener'},{frequency:1,_value:'adobe-illustrator'},{frequency:1,_value:'adsense'},{frequency:1,_value:'air'},{frequency:1,_value:'algorithm'},{frequency:1,_value:'altova'},{frequency:1,_value:'android'},{frequency:1,_value:'anonymous-methods'},{frequency:1,_value:'any'},{frequency:1,_value:'apache-camel'},{frequency:1,_value:'api-design'},{frequency:1,_value:'apostrophe'},{frequency:1,_value:'appearance'},{frequency:1,_value:'appendchild'},{frequency:1,_value:'appendfile'},{frequency:1,_value:'appendto'},{frequency:1,_value:'architecture'},{frequency:1,_value:'arduino'},{frequency:1,_value:'arraylist'},{frequency:1,_value:'asset-pipeline'},{frequency:1,_value:'assets'},{frequency:1,_value:'atl'},{frequency:1,_value:'attachevent'},{frequency:1,_value:'attr'},{frequency:1,_value:'attributes'},{frequency:1,_value:'audio'},{frequency:1,_value:'behavior'},{frequency:1,_value:'between'},{frequency:1,_value:'bigdecimal'},{frequency:1,_value:'binary'},{frequency:1,_value:'binding'},{frequency:1,_value:'bing-maps'},{frequency:1,_value:'blocking'},{frequency:1,_value:'blur'},{frequency:1,_value:'boolean-logic'},{frequency:1,_value:'bootstrap-modal'},{frequency:1,_value:'bootstrap-select'},{frequency:1,_value:'brackets'},{frequency:1,_value:'breakpoints'},{frequency:1,_value:'browser-cache'},{frequency:1,_value:'browser-detection'},{frequency:1,_value:'browser-history'},{frequency:1,_value:'browser-state'},{frequency:1,_value:'browser-support'},{frequency:1,_value:'build'},{frequency:1,_value:'c#-4.0'},{frequency:1,_value:'cakephp'},{frequency:1,_value:'cakephp-1.3'},{frequency:1,_value:'calculator'},{frequency:1,_value:'callstack'},{frequency:1,_value:'canjs'},{frequency:1,_value:'capitalization'},{frequency:1,_value:'capybara'},{frequency:1,_value:'casting'},{frequency:1,_value:'cdn'},{frequency:1,_value:'cell'},{frequency:1,_value:'centering'},{frequency:1,_value:'cgi'},{frequency:1,_value:'chaining'},{frequency:1,_value:'character-encoding'},{frequency:1,_value:'checked'},{frequency:1,_value:'cheerio'},{frequency:1,_value:'clear'},{frequency:1,_value:'cli'},{frequency:1,_value:'client-side'},{frequency:1,_value:'clone'},{frequency:1,_value:'closest'},{frequency:1,_value:'co'},{frequency:1,_value:'code-analysis'},{frequency:1,_value:'code-coverage'},{frequency:1,_value:'code-formatting'},{frequency:1,_value:'code-organization'},{frequency:1,_value:'code-review'},{frequency:1,_value:'coffeescript'},{frequency:1,_value:'commenting'},{frequency:1,_value:'compare'},{frequency:1,_value:'compatibility'},{frequency:1,_value:'compression'},{frequency:1,_value:'conceptual'},{frequency:1,_value:'condition'},{frequency:1,_value:'conflict'},{frequency:1,_value:'const'},{frequency:1,_value:'constructor'},{frequency:1,_value:'content-management-system'},{frequency:1,_value:'contenteditable'},{frequency:1,_value:'contour'},{frequency:1,_value:'correctness'},{frequency:1,_value:'cors'},{frequency:1,_value:'couchdb'},{frequency:1,_value:'createelement'},{frequency:1,_value:'credentials'},{frequency:1,_value:'cross-reference'},{frequency:1,_value:'css-box-shadow'},{frequency:1,_value:'css-float'},{frequency:1,_value:'css-specificity'},{frequency:1,_value:'css-tables'},{frequency:1,_value:'csv'},{frequency:1,_value:'cucumber'},{frequency:1,_value:'curl'},{frequency:1,_value:'curly-braces'},{frequency:1,_value:'cursor'},{frequency:1,_value:'dart'},{frequency:1,_value:'data-visualization'},{frequency:1,_value:'datatables'},{frequency:1,_value:'datetimeoffset'},{frequency:1,_value:'decimal'},{frequency:1,_value:'decode'},{frequency:1,_value:'deep-copy'},{frequency:1,_value:'definition'},{frequency:1,_value:'delay'},{frequency:1,_value:'delimiter'},{frequency:1,_value:'deserialization'},{frequency:1,_value:'design-patterns'},{frequency:1,_value:'dhtml'},{frequency:1,_value:'diacritics'},{frequency:1,_value:'dialog'},{frequency:1,_value:'diff'},{frequency:1,_value:'difference'},{frequency:1,_value:'digit'},{frequency:1,_value:'distinct-values'},{frequency:1,_value:'division'},{frequency:1,_value:'django-csrf'},{frequency:1,_value:'doctype'},{frequency:1,_value:'document-root'},{frequency:1,_value:'document.ready'},{frequency:1,_value:'document.write'},{frequency:1,_value:'documentation'},{frequency:1,_value:'dojo'},{frequency:1,_value:'domcontentloaded'},{frequency:1,_value:'double'},{frequency:1,_value:'double-click'},{frequency:1,_value:'download'},{frequency:1,_value:'drag-and-drop'},{frequency:1,_value:'drawing'},{frequency:1,_value:'dropbox'},{frequency:1,_value:'drupal-7'},{frequency:1,_value:'duplicate-data'},{frequency:1,_value:'duplicates'},{frequency:1,_value:'dygraphs'},{frequency:1,_value:'ecma262'},{frequency:1,_value:'ecmascript-4'},{frequency:1,_value:'ecmascript-harmony'},{frequency:1,_value:'editbox'},{frequency:1,_value:'editor'},{frequency:1,_value:'effect'},{frequency:1,_value:'effects'},{frequency:1,_value:'elasticsearch'},{frequency:1,_value:'email'},{frequency:1,_value:'email-validation'},{frequency:1,_value:'encapsulation'},{frequency:1,_value:'enumeration'},{frequency:1,_value:'enums'},{frequency:1,_value:'envjs'},{frequency:1,_value:'etl'},{frequency:1,_value:'evaluation'},{frequency:1,_value:'event-propagation'},{frequency:1,_value:'execute'},{frequency:1,_value:'execution'},{frequency:1,_value:'expand'},{frequency:1,_value:'expandable'},{frequency:1,_value:'exploded'},{frequency:1,_value:'export'},{frequency:1,_value:'express'},{frequency:1,_value:'external'},{frequency:1,_value:'extjs'},{frequency:1,_value:'facebook-graph-api'},{frequency:1,_value:'feature-detection'},{frequency:1,_value:'feed'},{frequency:1,_value:'field'},{frequency:1,_value:'file-download'},{frequency:1,_value:'file-extension'},{frequency:1,_value:'filelist'},{frequency:1,_value:'filter'},{frequency:1,_value:'filtering'},{frequency:1,_value:'find'},{frequency:1,_value:'firebase'},{frequency:1,_value:'firefox-3'},{frequency:1,_value:'firefox-addon-sdk'},{frequency:1,_value:'flash'},{frequency:1,_value:'floating-point'},{frequency:1,_value:'folder'},{frequency:1,_value:'font-face'},{frequency:1,_value:'font-size'},{frequency:1,_value:'footer'},{frequency:1,_value:'for-in-loop'},{frequency:1,_value:'format'},{frequency:1,_value:'fractions'},{frequency:1,_value:'frames'},{frequency:1,_value:'function-declaration'},{frequency:1,_value:'function-overloading'},{frequency:1,_value:'function-pointers'},{frequency:1,_value:'functional-programming'},{frequency:1,_value:'galleria'},{frequency:1,_value:'geolocation'},{frequency:1,_value:'geospatial'},{frequency:1,_value:'getboundingclientrect'},{frequency:1,_value:'getscript'},{frequency:1,_value:'gis'},{frequency:1,_value:'github'},{frequency:1,_value:'global'},{frequency:1,_value:'google-app-engine'},{frequency:1,_value:'google-charts-api'},{frequency:1,_value:'gradient'},{frequency:1,_value:'graph'},{frequency:1,_value:'graphic-effects'},{frequency:1,_value:'group'},{frequency:1,_value:'gruntjs'},{frequency:1,_value:'hammer.js'},{frequency:1,_value:'hash'},{frequency:1,_value:'hashset'},{frequency:1,_value:'head'},{frequency:1,_value:'header'},{frequency:1,_value:'hex'},{frequency:1,_value:'hidden'},{frequency:1,_value:'hiddenfield'},{frequency:1,_value:'highcharts'},{frequency:1,_value:'highlighting'},{frequency:1,_value:'hoisting'},{frequency:1,_value:'hotmail'},{frequency:1,_value:'href'},{frequency:1,_value:'htc'},{frequency:1,_value:'html-entities'},{frequency:1,_value:'html-input'},{frequency:1,_value:'html-parsing'},{frequency:1,_value:'html-sanitizing'},{frequency:1,_value:'html-table'},{frequency:1,_value:'html5-history'},{frequency:1,_value:'html5-video'},{frequency:1,_value:'htmlcollection'},{frequency:1,_value:'htmlunit'},{frequency:1,_value:'httpd'},{frequency:1,_value:'icheck'},{frequency:1,_value:'ietester'},{frequency:1,_value:'immutability'},{frequency:1,_value:'implementation'},{frequency:1,_value:'index'},{frequency:1,_value:'indexes'},{frequency:1,_value:'indexof'},{frequency:1,_value:'injection'},{frequency:1,_value:'innertext'},{frequency:1,_value:'input-field'},{frequency:1,_value:'int'},{frequency:1,_value:'integer'},{frequency:1,_value:'internet-explorer-10'},{frequency:1,_value:'internet-explorer-6'},{frequency:1,_value:'iphone'},{frequency:1,_value:'jade'},{frequency:1,_value:'javascript-objects'},{frequency:1,_value:'jax-ws'},{frequency:1,_value:'jquery-draggable'},{frequency:1,_value:'jquery-droppable'},{frequency:1,_value:'jquery-easing'},{frequency:1,_value:'jquery-effects'},{frequency:1,_value:'jquery-jscrollpane'},{frequency:1,_value:'jquery-manipulation'},{frequency:1,_value:'jquery-post'},{frequency:1,_value:'jquery-selectbox'},{frequency:1,_value:'jquery-templates'},{frequency:1,_value:'jquery-ui-datepicker'},{frequency:1,_value:'jscolor'},{frequency:1,_value:'jscrollpane'},{frequency:1,_value:'jsf'},{frequency:1,_value:'jsfiddle'},{frequency:1,_value:'json-encode'},{frequency:1,_value:'jsrender'},{frequency:1,_value:'jsviews'},{frequency:1,_value:'kendo-dataviz'},{frequency:1,_value:'keyboard'},{frequency:1,_value:'keyboard-input'},{frequency:1,_value:'keyboard-shortcuts'},{frequency:1,_value:'knockout-2.0'},{frequency:1,_value:'knowledge-management'},{frequency:1,_value:'lamp'},{frequency:1,_value:'language-agnostic'},{frequency:1,_value:'latitude-longitude'},{frequency:1,_value:'lava'},{frequency:1,_value:'layer'},{frequency:1,_value:'libraries'},{frequency:1,_value:'libreoffice'},{frequency:1,_value:'libxml2'},{frequency:1,_value:'light'},{frequency:1,_value:'line'},{frequency:1,_value:'linear-gradients'},{frequency:1,_value:'linkedin'},{frequency:1,_value:'linker'},{frequency:1,_value:'links'},{frequency:1,_value:'lodash'},{frequency:1,_value:'long-polling'},{frequency:1,_value:'magento'},{frequency:1,_value:'manipulation'},{frequency:1,_value:'mathjs'},{frequency:1,_value:'md5'},{frequency:1,_value:'mediawiki'},{frequency:1,_value:'menu'},{frequency:1,_value:'merge'},{frequency:1,_value:'message-queue'},{frequency:1,_value:'metadata'},{frequency:1,_value:'mime-types'},{frequency:1,_value:'minification'},{frequency:1,_value:'minify'},{frequency:1,_value:'minimize'},{frequency:1,_value:'mobile-safari'},{frequency:1,_value:'mocha'},{frequency:1,_value:'modal-dialog'},{frequency:1,_value:'module-pattern'},{frequency:1,_value:'mongodb'},{frequency:1,_value:'mootools'},{frequency:1,_value:'mouseclick-event'},{frequency:1,_value:'mousedown'},{frequency:1,_value:'mouseenter'},{frequency:1,_value:'mouseover'},{frequency:1,_value:'mozilla'},{frequency:1,_value:'ms-word'},{frequency:1,_value:'msxml'},{frequency:1,_value:'msxml6'},{frequency:1,_value:'multi-select'},{frequency:1,_value:'multidimensional'},{frequency:1,_value:'mustache'},{frequency:1,_value:'mutable'},{frequency:1,_value:'name-collision'},{frequency:1,_value:'naming-conventions'},{frequency:1,_value:'networking'},{frequency:1,_value:'newline'},{frequency:1,_value:'notepad++'},{frequency:1,_value:'notimplementedexception'},{frequency:1,_value:'ntp'},{frequency:1,_value:'null'},{frequency:1,_value:'number-formatting'},{frequency:1,_value:'number-manipulation'},{frequency:1,_value:'numbers'},{frequency:1,_value:'numerical'},{frequency:1,_value:'oauth'},{frequency:1,_value:'object-literal'},{frequency:1,_value:'objective-c'},{frequency:1,_value:'odt'},{frequency:1,_value:'onblur'},{frequency:1,_value:'onfocus'},{frequency:1,_value:'onload-event'},{frequency:1,_value:'onmousemove'},{frequency:1,_value:'onmouseover'},{frequency:1,_value:'opacity'},{frequency:1,_value:'operators'},{frequency:1,_value:'optgroup'},{frequency:1,_value:'optimizer'},{frequency:1,_value:'option'},{frequency:1,_value:'oracle10g'},{frequency:1,_value:'outlook'},{frequency:1,_value:'overflow'},{frequency:1,_value:'override'},{frequency:1,_value:'paging'},{frequency:1,_value:'parameterization'},{frequency:1,_value:'parent-child'},{frequency:1,_value:'parseint'},{frequency:1,_value:'paste'},{frequency:1,_value:'pdf-conversion'},{frequency:1,_value:'permissions'},{frequency:1,_value:'plugins'},{frequency:1,_value:'pointers'},{frequency:1,_value:'polymer'},{frequency:1,_value:'postback'},{frequency:1,_value:'postmessage'},{frequency:1,_value:'pre'},{frequency:1,_value:'predicate'},{frequency:1,_value:'preload'},{frequency:1,_value:'prepend'},{frequency:1,_value:'prestashop'},{frequency:1,_value:'preview'},{frequency:1,_value:'printing'},{frequency:1,_value:'printing-web-page'},{frequency:1,_value:'prototype-programming'},{frequency:1,_value:'prototyping'},{frequency:1,_value:'publish'},{frequency:1,_value:'publish-subscribe'},{frequency:1,_value:'queue'},{frequency:1,_value:'qunit'},{frequency:1,_value:'race-condition'},{frequency:1,_value:'radio'},{frequency:1,_value:'radio-button'},{frequency:1,_value:'raspberry-pi'},{frequency:1,_value:'rational-numbers'},{frequency:1,_value:'regex-negation'},{frequency:1,_value:'reload'},{frequency:1,_value:'removeclass'},{frequency:1,_value:'repeat'},{frequency:1,_value:'report'},{frequency:1,_value:'request.servervariables'},{frequency:1,_value:'requestanimationframe'},{frequency:1,_value:'require'},{frequency:1,_value:'reserved'},{frequency:1,_value:'reserved-words'},{frequency:1,_value:'responsive-design'},{frequency:1,_value:'result'},{frequency:1,_value:'reverse'},{frequency:1,_value:'rhino'},{frequency:1,_value:'riak'},{frequency:1,_value:'rotation'},{frequency:1,_value:'rounding'},{frequency:1,_value:'ruby'},{frequency:1,_value:'ruby-on-rails-4'},{frequency:1,_value:'sanitization'},{frequency:1,_value:'savefiledialog'},{frequency:1,_value:'sax'},{frequency:1,_value:'screen-readers'},{frequency:1,_value:'scrollbar'},{frequency:1,_value:'selectbox'},{frequency:1,_value:'selection'},{frequency:1,_value:'selectors'},{frequency:1,_value:'semicolon'},{frequency:1,_value:'seo'},{frequency:1,_value:'serial-port'},{frequency:1,_value:'serialization'},{frequency:1,_value:'server-side-includes'},{frequency:1,_value:'serverside-javascript'},{frequency:1,_value:'session'},{frequency:1,_value:'session-cookies'},{frequency:1,_value:'sessionid'},{frequency:1,_value:'setter'},{frequency:1,_value:'setup'},{frequency:1,_value:'sha1'},{frequency:1,_value:'shadowbox'},{frequency:1,_value:'sharepoint'},{frequency:1,_value:'show'},{frequency:1,_value:'signalr'},{frequency:1,_value:'simple-html-dom'},{frequency:1,_value:'simplemodal'},{frequency:1,_value:'simulate'},{frequency:1,_value:'sizzle'},{frequency:1,_value:'sleep'},{frequency:1,_value:'slide'},{frequency:1,_value:'slider'},{frequency:1,_value:'slidetoggle'},{frequency:1,_value:'soap'},{frequency:1,_value:'socket.io'},{frequency:1,_value:'sockets'},{frequency:1,_value:'solr'},{frequency:1,_value:'source-code'},{frequency:1,_value:'splash-screen'},{frequency:1,_value:'spring-mvc'},{frequency:1,_value:'sqlite'},{frequency:1,_value:'src'},{frequency:1,_value:'stack'},{frequency:1,_value:'stack-trace'},{frequency:1,_value:'standards'},{frequency:1,_value:'storage'},{frequency:1,_value:'store'},{frequency:1,_value:'stored-procedures'},{frequency:1,_value:'stream'},{frequency:1,_value:'stringify'},{frequency:1,_value:'structure'},{frequency:1,_value:'styles'},{frequency:1,_value:'styling'},{frequency:1,_value:'sum'},{frequency:1,_value:'svg'},{frequency:1,_value:'sync'},{frequency:1,_value:'synchronous'},{frequency:1,_value:'tablesorter'},{frequency:1,_value:'tabs'},{frequency:1,_value:'tail-recursion'},{frequency:1,_value:'tampermonkey'},{frequency:1,_value:'template-engine'},{frequency:1,_value:'text-files'},{frequency:1,_value:'time'},{frequency:1,_value:'title'},{frequency:1,_value:'to-json'},{frequency:1,_value:'toggleclass'},{frequency:1,_value:'tokenize'},{frequency:1,_value:'tomcat'},{frequency:1,_value:'transform'},{frequency:1,_value:'traversal'},{frequency:1,_value:'trigonometry'},{frequency:1,_value:'trim'},{frequency:1,_value:'try-catch'},{frequency:1,_value:'tumblr'},{frequency:1,_value:'twitter-api'},{frequency:1,_value:'type-conversion'},{frequency:1,_value:'typed-arrays'},{frequency:1,_value:'typescript'},{frequency:1,_value:'ubuntu'},{frequency:1,_value:'unbind'},{frequency:1,_value:'undefined-behavior'},{frequency:1,_value:'unique'},{frequency:1,_value:'unobtrusive-javascript'},{frequency:1,_value:'unused-variables'},{frequency:1,_value:'url-parameters'},{frequency:1,_value:'url-rewriting'},{frequency:1,_value:'use-strict'},{frequency:1,_value:'user-controls'},{frequency:1,_value:'user-input'},{frequency:1,_value:'utc'},{frequency:1,_value:'v8'},{frequency:1,_value:'variable-assignment'},{frequency:1,_value:'variable-declaration'},{frequency:1,_value:'vbscript'},{frequency:1,_value:'viewport'},{frequency:1,_value:'virus'},{frequency:1,_value:'visibility'},{frequency:1,_value:'visual-studio'},{frequency:1,_value:'wait'},{frequency:1,_value:'wcf'},{frequency:1,_value:'web-audio'},{frequency:1,_value:'web-hosting'},{frequency:1,_value:'web-security'},{frequency:1,_value:'web-worker'},{frequency:1,_value:'web2py'},{frequency:1,_value:'webgl'},{frequency:1,_value:'webpage'},{frequency:1,_value:'webserver'},{frequency:1,_value:'widget'},{frequency:1,_value:'width'},{frequency:1,_value:'wiki'},{frequency:1,_value:'wikimedia'},{frequency:1,_value:'wikipedia'},{frequency:1,_value:'wikipedia-api'},{frequency:1,_value:'window'},{frequency:1,_value:'window.location'},{frequency:1,_value:'windows-phone-8'},{frequency:1,_value:'windows-server-2012'},{frequency:1,_value:'wordpress-mu'},{frequency:1,_value:'wpf'},{frequency:1,_value:'wsdl'},{frequency:1,_value:'xbrl'},{frequency:1,_value:'xforms'},{frequency:1,_value:'xhtml-1.0-strict'},{frequency:1,_value:'xml-libxml'},{frequency:1,_value:'xmlhttp'},{frequency:1,_value:'xmlstarlet'},{frequency:1,_value:'xpath-2.0'},{frequency:1,_value:'xquery-update'},{frequency:1,_value:'xss-prevention'},{frequency:1,_value:'yahoo'},{frequency:1,_value:'yield'},{frequency:1,_value:'yii'},{frequency:1,_value:'youtube'},{frequency:1,_value:'yql'},{frequency:1,_value:'yui'},{frequency:1,_value:'yui-compressor'},{frequency:1,_value:'yui3'},{frequency:1,_value:'z-index'},{frequency:1,_value:'zend-gdata'},{frequency:1,_value:'zepto'}],'aggregate-result':[{name:'count',_value:'6192'}],metrics:{'values-resolution-time':'PT0.042069S','aggregate-resolution-time':'PT0.015168S','total-time':'PT0.529259S'}}};
      var ret = {'values-response':{name:'tags',type:'xs:string','distinct-value':[{frequency:1557,_value:'javascript'},{frequency:987,_value:'jquery'},{frequency:372,_value:'html'},{frequency:151,_value:'xml'},{frequency:45,_value:'html5'},{frequency:19,_value:'xslt'},{frequency:17,_value:'angularjs'},{frequency:14,_value:'xhtml'},{frequency:7,_value:'jsonp'},{frequency:5,_value:'xmlhttprequest'},{frequency:3,_value:'bookmarklet'},{frequency:2,_value:'base64'},{frequency:2,_value:'gson'},{frequency:1,_value:'delimiter'},{frequency:1,_value:'mootools'},{frequency:1,_value:'riak'},{frequency:1,_value:'serialization'},{frequency:1,_value:'soap'}],'aggregate-result':[{name:'count',_value:'6192'}],metrics:{'values-resolution-time':'PT0.042069S','aggregate-resolution-time':'PT0.015168S','total-time':'PT0.529259S'}}};
      /* jshint ignore:end */

      sandbox.stub(connection.resources, 'get', function(sp) {
        var exSpec = {
          name: 'relatedTags',
          params: {
            'tag':spec.search.relatedTo
          }
        };
        sp.should.deep.equal(exSpec);
        return {
          result: function() {
            return Promise.resolve(getResult);
          }
        };
      });

      sandbox.stub(connection.documents, 'query', function(sp) {
        sp.should.deep.equal(querySpec);
        return {
          result: function() {
            return Promise.resolve(queryResult);
          }
        };
      })

      tags.getRelatedTags(spec).then(function(grtRet) {
        grtRet.should.deep.equal(ret);
        done();
      });

    });


  });
};
