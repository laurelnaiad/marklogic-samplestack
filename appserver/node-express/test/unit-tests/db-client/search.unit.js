/*
 * Copyright 2012-2015 MarkLogic Corporation
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
module.exports = function() {

  describe('search',function() {

    var sandbox;
    var Promise = require('bluebird');
    var db = require('../../../lib/db-client');
    var connection = db.getGenericClient('admin','admin');
    var search = require('../../../lib/db-client/search')(connection);

    beforeEach(function () {
      sandbox = sinon.sandbox.create();
    });

    afterEach(function () {
      sandbox.restore();
    });

    it('search', function (done) {
      /* jshint ignore:start */
      var spec = {search:{qtext:['acc','sort:relevance'],start:1,timezone:'America/Los_Angeles'},shadow:undefined};
      var docsQuery = {search:{qtext:['acc','sort:relevance'],timezone:'America/Los_Angeles',query:{'and-query':{queries:[{'directory-query':{uri:['/questions/']}}]}},options:{constraint:[{name:'date',range:{facet:true,'json-property':'lastActivityDate',type:'xs:dateTime',bucket:[{ge:'2009-05-01T00:00:00-07:00',lt:'2009-06-01T00:00:00-07:00',name:'2009-05-01T00:00:00-07:00',label:'2009-05-01T00:00:00-07:00'},{ge:'2009-06-01T00:00:00-07:00',lt:'2009-07-01T00:00:00-07:00',name:'2009-06-01T00:00:00-07:00',label:'2009-06-01T00:00:00-07:00'},{ge:'2009-07-01T00:00:00-07:00',lt:'2009-08-01T00:00:00-07:00',name:'2009-07-01T00:00:00-07:00',label:'2009-07-01T00:00:00-07:00'},{ge:'2009-08-01T00:00:00-07:00',lt:'2009-09-01T00:00:00-07:00',name:'2009-08-01T00:00:00-07:00',label:'2009-08-01T00:00:00-07:00'},{ge:'2009-09-01T00:00:00-07:00',lt:'2009-10-01T00:00:00-07:00',name:'2009-09-01T00:00:00-07:00',label:'2009-09-01T00:00:00-07:00'},{ge:'2009-10-01T00:00:00-07:00',lt:'2009-11-01T00:00:00-07:00',name:'2009-10-01T00:00:00-07:00',label:'2009-10-01T00:00:00-07:00'},{ge:'2009-11-01T00:00:00-07:00',lt:'2009-12-01T00:00:00-08:00',name:'2009-11-01T00:00:00-07:00',label:'2009-11-01T00:00:00-07:00'},{ge:'2009-12-01T00:00:00-08:00',lt:'2010-01-01T00:00:00-08:00',name:'2009-12-01T00:00:00-08:00',label:'2009-12-01T00:00:00-08:00'},{ge:'2010-01-01T00:00:00-08:00',lt:'2010-02-01T00:00:00-08:00',name:'2010-01-01T00:00:00-08:00',label:'2010-01-01T00:00:00-08:00'},{ge:'2010-02-01T00:00:00-08:00',lt:'2010-03-01T00:00:00-08:00',name:'2010-02-01T00:00:00-08:00',label:'2010-02-01T00:00:00-08:00'},{ge:'2010-03-01T00:00:00-08:00',lt:'2010-04-01T00:00:00-07:00',name:'2010-03-01T00:00:00-08:00',label:'2010-03-01T00:00:00-08:00'},{ge:'2010-04-01T00:00:00-07:00',lt:'2010-05-01T00:00:00-07:00',name:'2010-04-01T00:00:00-07:00',label:'2010-04-01T00:00:00-07:00'},{ge:'2010-05-01T00:00:00-07:00',lt:'2010-06-01T00:00:00-07:00',name:'2010-05-01T00:00:00-07:00',label:'2010-05-01T00:00:00-07:00'},{ge:'2010-06-01T00:00:00-07:00',lt:'2010-07-01T00:00:00-07:00',name:'2010-06-01T00:00:00-07:00',label:'2010-06-01T00:00:00-07:00'},{ge:'2010-07-01T00:00:00-07:00',lt:'2010-08-01T00:00:00-07:00',name:'2010-07-01T00:00:00-07:00',label:'2010-07-01T00:00:00-07:00'},{ge:'2010-08-01T00:00:00-07:00',lt:'2010-09-01T00:00:00-07:00',name:'2010-08-01T00:00:00-07:00',label:'2010-08-01T00:00:00-07:00'},{ge:'2010-09-01T00:00:00-07:00',lt:'2010-10-01T00:00:00-07:00',name:'2010-09-01T00:00:00-07:00',label:'2010-09-01T00:00:00-07:00'},{ge:'2010-10-01T00:00:00-07:00',lt:'2010-11-01T00:00:00-07:00',name:'2010-10-01T00:00:00-07:00',label:'2010-10-01T00:00:00-07:00'},{ge:'2010-11-01T00:00:00-07:00',lt:'2010-12-01T00:00:00-08:00',name:'2010-11-01T00:00:00-07:00',label:'2010-11-01T00:00:00-07:00'},{ge:'2010-12-01T00:00:00-08:00',lt:'2011-01-01T00:00:00-08:00',name:'2010-12-01T00:00:00-08:00',label:'2010-12-01T00:00:00-08:00'},{ge:'2011-01-01T00:00:00-08:00',lt:'2011-02-01T00:00:00-08:00',name:'2011-01-01T00:00:00-08:00',label:'2011-01-01T00:00:00-08:00'},{ge:'2011-02-01T00:00:00-08:00',lt:'2011-03-01T00:00:00-08:00',name:'2011-02-01T00:00:00-08:00',label:'2011-02-01T00:00:00-08:00'},{ge:'2011-03-01T00:00:00-08:00',lt:'2011-04-01T00:00:00-07:00',name:'2011-03-01T00:00:00-08:00',label:'2011-03-01T00:00:00-08:00'},{ge:'2011-04-01T00:00:00-07:00',lt:'2011-05-01T00:00:00-07:00',name:'2011-04-01T00:00:00-07:00',label:'2011-04-01T00:00:00-07:00'},{ge:'2011-05-01T00:00:00-07:00',lt:'2011-06-01T00:00:00-07:00',name:'2011-05-01T00:00:00-07:00',label:'2011-05-01T00:00:00-07:00'},{ge:'2011-06-01T00:00:00-07:00',lt:'2011-07-01T00:00:00-07:00',name:'2011-06-01T00:00:00-07:00',label:'2011-06-01T00:00:00-07:00'},{ge:'2011-07-01T00:00:00-07:00',lt:'2011-08-01T00:00:00-07:00',name:'2011-07-01T00:00:00-07:00',label:'2011-07-01T00:00:00-07:00'},{ge:'2011-08-01T00:00:00-07:00',lt:'2011-09-01T00:00:00-07:00',name:'2011-08-01T00:00:00-07:00',label:'2011-08-01T00:00:00-07:00'},{ge:'2011-09-01T00:00:00-07:00',lt:'2011-10-01T00:00:00-07:00',name:'2011-09-01T00:00:00-07:00',label:'2011-09-01T00:00:00-07:00'},{ge:'2011-10-01T00:00:00-07:00',lt:'2011-11-01T00:00:00-07:00',name:'2011-10-01T00:00:00-07:00',label:'2011-10-01T00:00:00-07:00'},{ge:'2011-11-01T00:00:00-07:00',lt:'2011-12-01T00:00:00-08:00',name:'2011-11-01T00:00:00-07:00',label:'2011-11-01T00:00:00-07:00'},{ge:'2011-12-01T00:00:00-08:00',lt:'2012-01-01T00:00:00-08:00',name:'2011-12-01T00:00:00-08:00',label:'2011-12-01T00:00:00-08:00'},{ge:'2012-01-01T00:00:00-08:00',lt:'2012-02-01T00:00:00-08:00',name:'2012-01-01T00:00:00-08:00',label:'2012-01-01T00:00:00-08:00'},{ge:'2012-02-01T00:00:00-08:00',lt:'2012-03-01T00:00:00-08:00',name:'2012-02-01T00:00:00-08:00',label:'2012-02-01T00:00:00-08:00'},{ge:'2012-03-01T00:00:00-08:00',lt:'2012-04-01T00:00:00-07:00',name:'2012-03-01T00:00:00-08:00',label:'2012-03-01T00:00:00-08:00'},{ge:'2012-04-01T00:00:00-07:00',lt:'2012-05-01T00:00:00-07:00',name:'2012-04-01T00:00:00-07:00',label:'2012-04-01T00:00:00-07:00'},{ge:'2012-05-01T00:00:00-07:00',lt:'2012-06-01T00:00:00-07:00',name:'2012-05-01T00:00:00-07:00',label:'2012-05-01T00:00:00-07:00'},{ge:'2012-06-01T00:00:00-07:00',lt:'2012-07-01T00:00:00-07:00',name:'2012-06-01T00:00:00-07:00',label:'2012-06-01T00:00:00-07:00'},{ge:'2012-07-01T00:00:00-07:00',lt:'2012-08-01T00:00:00-07:00',name:'2012-07-01T00:00:00-07:00',label:'2012-07-01T00:00:00-07:00'},{ge:'2012-08-01T00:00:00-07:00',lt:'2012-09-01T00:00:00-07:00',name:'2012-08-01T00:00:00-07:00',label:'2012-08-01T00:00:00-07:00'},{ge:'2012-09-01T00:00:00-07:00',lt:'2012-10-01T00:00:00-07:00',name:'2012-09-01T00:00:00-07:00',label:'2012-09-01T00:00:00-07:00'},{ge:'2012-10-01T00:00:00-07:00',lt:'2012-11-01T00:00:00-07:00',name:'2012-10-01T00:00:00-07:00',label:'2012-10-01T00:00:00-07:00'},{ge:'2012-11-01T00:00:00-07:00',lt:'2012-12-01T00:00:00-08:00',name:'2012-11-01T00:00:00-07:00',label:'2012-11-01T00:00:00-07:00'},{ge:'2012-12-01T00:00:00-08:00',lt:'2013-01-01T00:00:00-08:00',name:'2012-12-01T00:00:00-08:00',label:'2012-12-01T00:00:00-08:00'},{ge:'2013-01-01T00:00:00-08:00',lt:'2013-02-01T00:00:00-08:00',name:'2013-01-01T00:00:00-08:00',label:'2013-01-01T00:00:00-08:00'},{ge:'2013-02-01T00:00:00-08:00',lt:'2013-03-01T00:00:00-08:00',name:'2013-02-01T00:00:00-08:00',label:'2013-02-01T00:00:00-08:00'},{ge:'2013-03-01T00:00:00-08:00',lt:'2013-04-01T00:00:00-07:00',name:'2013-03-01T00:00:00-08:00',label:'2013-03-01T00:00:00-08:00'},{ge:'2013-04-01T00:00:00-07:00',lt:'2013-05-01T00:00:00-07:00',name:'2013-04-01T00:00:00-07:00',label:'2013-04-01T00:00:00-07:00'},{ge:'2013-05-01T00:00:00-07:00',lt:'2013-06-01T00:00:00-07:00',name:'2013-05-01T00:00:00-07:00',label:'2013-05-01T00:00:00-07:00'},{ge:'2013-06-01T00:00:00-07:00',lt:'2013-07-01T00:00:00-07:00',name:'2013-06-01T00:00:00-07:00',label:'2013-06-01T00:00:00-07:00'},{ge:'2013-07-01T00:00:00-07:00',lt:'2013-08-01T00:00:00-07:00',name:'2013-07-01T00:00:00-07:00',label:'2013-07-01T00:00:00-07:00'},{ge:'2013-08-01T00:00:00-07:00',lt:'2013-09-01T00:00:00-07:00',name:'2013-08-01T00:00:00-07:00',label:'2013-08-01T00:00:00-07:00'},{ge:'2013-09-01T00:00:00-07:00',lt:'2013-10-01T00:00:00-07:00',name:'2013-09-01T00:00:00-07:00',label:'2013-09-01T00:00:00-07:00'},{ge:'2013-10-01T00:00:00-07:00',lt:'2013-11-01T00:00:00-07:00',name:'2013-10-01T00:00:00-07:00',label:'2013-10-01T00:00:00-07:00'},{ge:'2013-11-01T00:00:00-07:00',lt:'2013-12-01T00:00:00-08:00',name:'2013-11-01T00:00:00-07:00',label:'2013-11-01T00:00:00-07:00'},{ge:'2013-12-01T00:00:00-08:00',lt:'2014-01-01T00:00:00-08:00',name:'2013-12-01T00:00:00-08:00',label:'2013-12-01T00:00:00-08:00'},{ge:'2014-01-01T00:00:00-08:00',lt:'2014-02-01T00:00:00-08:00',name:'2014-01-01T00:00:00-08:00',label:'2014-01-01T00:00:00-08:00'},{ge:'2014-02-01T00:00:00-08:00',lt:'2014-03-01T00:00:00-08:00',name:'2014-02-01T00:00:00-08:00',label:'2014-02-01T00:00:00-08:00'},{ge:'2014-03-01T00:00:00-08:00',lt:'2014-04-01T00:00:00-07:00',name:'2014-03-01T00:00:00-08:00',label:'2014-03-01T00:00:00-08:00'},{ge:'2014-04-01T00:00:00-07:00',lt:'2014-05-01T00:00:00-07:00',name:'2014-04-01T00:00:00-07:00',label:'2014-04-01T00:00:00-07:00'},{ge:'2014-05-01T00:00:00-07:00',lt:'2014-06-01T00:00:00-07:00',name:'2014-05-01T00:00:00-07:00',label:'2014-05-01T00:00:00-07:00'},{ge:'2014-06-01T00:00:00-07:00',lt:'2014-07-01T00:00:00-07:00',name:'2014-06-01T00:00:00-07:00',label:'2014-06-01T00:00:00-07:00'},{ge:'2014-07-01T00:00:00-07:00',lt:'2014-08-01T00:00:00-07:00',name:'2014-07-01T00:00:00-07:00',label:'2014-07-01T00:00:00-07:00'},{ge:'2014-08-01T00:00:00-07:00',lt:'2014-09-01T00:00:00-07:00',name:'2014-08-01T00:00:00-07:00',label:'2014-08-01T00:00:00-07:00'},{ge:'2014-09-01T00:00:00-07:00',lt:'2014-10-01T00:00:00-07:00',name:'2014-09-01T00:00:00-07:00',label:'2014-09-01T00:00:00-07:00'},{ge:'2014-10-01T00:00:00-07:00',lt:'2014-11-01T00:00:00-07:00',name:'2014-10-01T00:00:00-07:00',label:'2014-10-01T00:00:00-07:00'},{ge:'2014-11-01T00:00:00-07:00',lt:'2014-12-01T00:00:00-08:00',name:'2014-11-01T00:00:00-07:00',label:'2014-11-01T00:00:00-07:00'},{ge:'2014-12-01T00:00:00-08:00',lt:'2015-01-01T00:00:00-08:00',name:'2014-12-01T00:00:00-08:00',label:'2014-12-01T00:00:00-08:00'},{ge:'2015-01-01T00:00:00-08:00',lt:'2015-02-01T00:00:00-08:00',name:'2015-01-01T00:00:00-08:00',label:'2015-01-01T00:00:00-08:00'},{ge:'2015-02-01T00:00:00-08:00',lt:'2015-03-01T00:00:00-08:00',name:'2015-02-01T00:00:00-08:00',label:'2015-02-01T00:00:00-08:00'},{ge:'2015-03-01T00:00:00-08:00',lt:'2015-04-01T00:00:00-07:00',name:'2015-03-01T00:00:00-08:00',label:'2015-03-01T00:00:00-08:00'},{ge:'2015-04-01T00:00:00-07:00',lt:'2015-05-01T00:00:00-07:00',name:'2015-04-01T00:00:00-07:00',label:'2015-04-01T00:00:00-07:00'},{ge:'2015-05-01T00:00:00-07:00',lt:'2015-06-01T00:00:00-07:00',name:'2015-05-01T00:00:00-07:00',label:'2015-05-01T00:00:00-07:00'},{ge:'2015-06-01T00:00:00-07:00',lt:'2015-07-01T00:00:00-07:00',name:'2015-06-01T00:00:00-07:00',label:'2015-06-01T00:00:00-07:00'},{ge:'2015-07-01T00:00:00-07:00',lt:'2015-08-01T00:00:00-07:00',name:'2015-07-01T00:00:00-07:00',label:'2015-07-01T00:00:00-07:00'},{ge:'2015-08-01T00:00:00-07:00',lt:'2015-09-01T00:00:00-07:00',name:'2015-08-01T00:00:00-07:00',label:'2015-08-01T00:00:00-07:00'}]}}]}},shadow:undefined,pageStart:1,pageLength:10,optionsName:'questions',transform:'search-response',view:'all'};
      var docsQueryResult = [{'snippet-format':'snippet',total:5,start:1,'page-length':10,results:[{index:1,uri:'/questions/soq7547644.json',path:'fn:doc("/questions/soq7547644.json")',score:107520,confidence:0.5543764,fitness:0.8520157,href:'/v1/documents?uri=%2Fquestions%2Fsoq7547644.json',mimetype:'application/json',format:'json',matches:[{'match-text':['...:\n\tfunction getElement()\n\t{   \n\t var ',{highlight:'acc'},'_list = document.forms.editBeneficiary.elements...'],source:'question',id:'soq7547644'}]},{index:2,uri:'/questions/soq22303738.json',path:'fn:doc("/questions/soq22303738.json")',score:107520,confidence:0.5543764,fitness:0.8520157,href:'/v1/documents?uri=%2Fquestions%2Fsoq22303738.json',mimetype:'application/json',format:'json',matches:[{'match-text':['..., len = list.length;\n\t    var ',{highlight:'acc'},' = arguments.length > 2 ?... ...< len; i++){ ',{highlight:'acc'},' = accumulator...'],source:'answer',id:'soa22303786'}]},{index:3,uri:'/questions/soq21891002.json',path:'fn:doc("/questions/soq21891002.json")',score:92160,confidence:0.5132529,fitness:0.7888133,href:'/v1/documents?uri=%2Fquestions%2Fsoq21891002.json',mimetype:'application/json',format:'json',matches:[{'match-text':['...CSS property will enable the hardware ',{highlight:'acc'},'.\nIf 3D transforms is supported,... ...',{highlight:'acc'},'... ...',{highlight:'acc'},' /...'],source:'answer',id:'soa22113507'}]},{index:4,uri:'/questions/soq7538483.json',path:'fn:doc("/questions/soq7538483.json")',score:82944,confidence:0.4869144,fitness:0.748334,href:'/v1/documents?uri=%2Fquestions%2Fsoq7538483.json',mimetype:'application/json',format:'json',matches:[{'match-text':['...[].reduce.call(elements, function (',{highlight:'acc'},', e) {\n\t    return e.className... ...reduce(unique, ',{highlight:'acc'},');...'],source:'answer',id:'soa7540783'}]},{index:5,uri:'/questions/soq14433212.json',path:'fn:doc("/questions/soq14433212.json")',score:58368,confidence:0.4084581,fitness:0.6277553,href:'/v1/documents?uri=%2Fquestions%2Fsoq14433212.json',mimetype:'application/json',format:'json',matches:[{'match-text':['...url: \'https://tt.s2.',{highlight:'acc'},'.com/ttm/subscribe-service/uid=sagar...'],source:'answer',id:'soa14436840'}]}],facets:{date:{type:'bucketed',facetValues:[{name:'2011-09-01T00:00:00-07:00',count:1,value:'2011-09-01T00:00:00-07:00'},{name:'2013-01-01T00:00:00-08:00',count:1,value:'2013-01-01T00:00:00-08:00'},{name:'2013-07-01T00:00:00-07:00',count:1,value:'2013-07-01T00:00:00-07:00'},{name:'2014-03-01T00:00:00-08:00',count:2,value:'2014-03-01T00:00:00-08:00'}]},tag:{type:'xs:string',facetValues:[{name:'html',count:4,value:'html'},{name:'javascript',count:4,value:'javascript'},{name:'jquery',count:2,value:'jquery'},{name:'css',count:1,value:'css'},{name:'safari',count:1,value:'safari'},{name:'scroll',count:1,value:'scroll'}]}},query:{'and-query':[{'field-word-query':[{field:'default-samplestack-search',text:{lang:'en',_value:'acc'}}],'directory-query':[{uri:'/questions/'}],annotation:[{'operator-ref':'sort','state-ref':'relevance'}]}]},qtext:'sort:relevance',report:'(cts:search(fn:collection(), cts:and-query((cts:field-word-query("default-samplestack-search", "acc", ("lang=en"), 1), cts:directory-query("/questions/", "1"), cts:json-property-range-query("voteCount", ">=", -10, ("score-function=linear"), 1)), ()), ("score-logtfidf","faceted",cts:score-order("descending")), 1))[1 to 10]',metrics:{'query-resolution-time':'PT0.04554S','facet-resolution-time':'PT0.043808S','snippet-resolution-time':'PT0.039879S','total-time':'PT0.394596S'}},{uri:'/questions/soq7547644.json',category:'content',format:'json',contentType:'application/json',contentLength:'1622',content:{tags:['javascript','html'],originalId:'7547644',owner:{id:'sou924821',reputation:428,originalId:'924821',userName:'souser924821@example.com',displayName:'Nitin Kabra'},lastActivityDate:'2011-09-25T19:44:52.887Z',id:'soq7547644',answerCount:2,voteCount:4,accepted:true,downvotingContributorIds:[],text:'I have a variable account_number in which account number is stored. now i want to get the value of the element having id as account_number. How to do it in javascript ? \n\nI tried doing document.getElementById(account_number).value, but it is null.\n\nhtml looks like this :\n\n\t<input class=\'transparent\' disabled type=\'text\' name=\'113114234567_name\' id=\'113114234567_name\' value = \'Neeloy\' style=\'border:0px;height:25px;font-size:16px;line-height:25px;\' />\n\t\n\nand the js is :\n\n\tfunction getElement()\n\t{   \n\t var acc_list = document.forms.editBeneficiary.elements.bene_account_number_edit;\n\t\n\t    for(var i=0;i<acc_list.length;i++)\n\t        {\n\t            if(acc_list[i].checked == true)\n\t                {\n\t\n\t                    var account_number = acc_list[i].value.toString();\n\t                    var ben_name = account_number + "_name";\n\t\n\t                    alert(document.getElementById("\'" + ben_name.toString() + "\'").value);\n\t                }\n\t         }\n\t\n\n}\n\nhere bene_account_number_edit are the radio buttons.\n\nThanks ',creationDate:'2011-09-25T18:31:00.860Z',itemTally:0,upvotingContributorIds:[],title:'Pass variable in document.getElementByid in javascript',acceptedAnswerId:'soa7547693'}},{uri:'/questions/soq22303738.json',category:'content',format:'json',contentType:'application/json',contentLength:'1326',content:{tags:['javascript'],originalId:'22303738',owner:{id:'sou1712334',reputation:331,originalId:'1712334',userName:'souser1712334@example.com',displayName:'FatalProphet'},lastActivityDate:'2014-03-10T16:03:25.920Z',id:'soq22303738',answerCount:4,voteCount:17,accepted:true,downvotingContributorIds:['unknown'],text:'I\'d like to write a function in Javascript that allows me to pass in a mathematical operator and a list of ints and for each item in that list, apply the operator to it. \n\nThinking of it in terms of a sum, this is what I\'ve come up with:\n\n\tfunction accumulate(list, operator){\n\t    var sum = 0;\n\t    for each(var item in list){\n\t        sum = accumulator(sum, item);\n\t    }\n\t    print(sum);\n\t}\n\t\n\nTesting this code produces the following error:\n\n\tvar list = new Array();\n\tlist[0] = 1;\n\tlist[1] = 2;\n\tlist[2] = 3;\n\t\n\t\n\tjs> accumulate(list, +);\n\tjs: "<stdin>", line 9: syntax error\n\tjs: accumulate(list, +);\n\tjs: ..................^\n\tjs: "<stdin>", line 9: Compilation produced 1 syntax errors.\n\t',creationDate:'2014-03-10T15:01:34.677Z',itemTally:3,upvotingContributorIds:['unknown','unknown','unknown','unknown'],title:'Javascript: Passing a math operator as a parameter',acceptedAnswerId:'soa22303786'}},{uri:'/questions/soq21891002.json',category:'content',format:'json',contentType:'application/json',contentLength:'2281',content:{tags:['javascript','jquery','html','safari','scroll'],originalId:'21891002',owner:{id:'sou2363',reputation:14546,originalId:'2363',userName:'souser2363@example.com',displayName:'tghw'},lastActivityDate:'2014-03-01T11:10:47.287Z',id:'soq21891002',answerCount:4,voteCount:36,accepted:true,downvotingContributorIds:[],text:'I have a web page with three divs that are synced together. \n\n\t    +----------+\n\t    |   TOP    |\n\t+---+----------+\n\t|   |         ||\n\t| L | CENTER  ||\n\t|   |_________||\n\t+---+----------+\n\t\n\t<!--Rough HTML-->\n\t<div>\n\t  <div class="topbar-wrapper">\n\t    <div class="topbar"></div>\n\t  </div>\n\t  <div class="container">\n\t    <div class="sidebar-wrapper">\n\t      <div class="sidebar"></div>\n\t    </div>\n\t    <div class="center-wrapper"> <!-- Set to the window size & overflow:scroll -->\n\t      <div class="center"></div> <!-- Has the content -->\n\t    </div>\n\t  </div>\n\t</div>\n\t\n\nThe center div has scroll bars, both horizontal and vertical. The top and left divs do not have scroll bars. Instead, when the horizontal scroll bar is moved, the scroll event updates the top div\'s `margin-left` appropriately. Likewise when the vertical scroll bar is moved, the `margin-top` is updated. In both cases, they are set to a negative value.\n\n\t$(\'.center-wrapper\').scroll(function(e) {\n\t  $(\'.sidebar\').css({marginTop: -1 * $(this).scrollTop()});\n\t  $(\'.topbar\').css({marginLeft: -1 * $(this).scrollLeft()});\n\t});\n\t\n\nThis works fine in Chrome and Firefox. But in Safari, there is a delay between moving the scroll bar and the negative margin being properly set.\n\nIs there a better way to do this? Or is there some way to get rid of the lag in Safari?\n\nEDIT:\n\nCheck out this Fiddle to see the lag in Safari: [http://jsfiddle.net/qh2K3/](http://jsfiddle.net/qh2K3/)',creationDate:'2014-02-19T19:56:14.177Z',itemTally:19,upvotingContributorIds:['unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown'],title:'Sync scrollbar div to non-scrolled div',acceptedAnswerId:'soa22022640'}},{uri:'/questions/soq7538483.json',category:'content',format:'json',contentType:'application/json',contentLength:'699',content:{tags:['html','css'],originalId:'7538483',owner:{id:'sou130452',reputation:874,originalId:'130452',userName:'souser130452@example.com',displayName:'KuldipMCA'},lastActivityDate:'2013-07-31T15:06:21.333Z',id:'soq7538483',answerCount:3,voteCount:15,accepted:true,downvotingContributorIds:[],text:'I need list of classes used in an html file. Is there any tool where i can get list of classes in the HTML file?',creationDate:'2011-09-24T10:38:08.450Z',itemTally:6,upvotingContributorIds:['unknown','unknown','unknown','unknown','unknown','unknown'],title:'How to get list of Css class use in the HTML file?',acceptedAnswerId:'soa7540783'}},{uri:'/questions/soq14433212.json',category:'content',format:'json',contentType:'application/json',contentLength:'1574',content:{tags:['javascript','jquery','html'],originalId:'14433212',owner:{id:'sou1687825',reputation:183,originalId:'1687825',userName:'souser1687825@example.com',displayName:'Rishi'},lastActivityDate:'2013-01-21T10:39:49.000Z',id:'soq14433212',answerCount:2,voteCount:9,accepted:true,downvotingContributorIds:[],text:'I have a url which gives json data...\n\nI want to hit that URL from javascript but I am getting this error :\n\ncharacter encoding of the plain text document was not declared. The document will render with garbled text in some browser configurations if the document contains characters from outside the US-ASCII range. The character encoding of the file needs to be declared in the transfer protocol or file needs to use a byte order mark as an encoding signature\n\nCode :\n\n\tfunction a(){\n\t$.getJSON(url,function(data) { alert(data);});\n\t}\n\t\n\nfull code :\n\n\t<html lang="en">\n\t<head>\n\t<meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>\n\t<script language="JavaScript" type="text/javascript" src="jquery-1.7.1.min.js"></script>\n\t<script>\n\t\n\tfunction a(){\n\t$.getJSON(url,function(data) { alert(data);});\n\t}\n\t</script>\n\t</head>\n\t<body>\n\t<input type="text"/>\n\t<input type="submit" value="search" onclick="a()"/>\n\t</body>\n\t</html>\n\t',creationDate:'2013-01-21T06:13:31.083Z',itemTally:3,upvotingContributorIds:['unknown','unknown','unknown'],title:'how to call REST API from javascript',acceptedAnswerId:'soa14433462'}}];
      var ret = {'snippet-format':'snippet',total:5,start:1,'page-length':10,results:[{index:1,uri:'/questions/soq7547644.json',path:'fn:doc("/questions/soq7547644.json")',score:107520,confidence:0.5543764,fitness:0.8520157,href:'/v1/documents?uri=%2Fquestions%2Fsoq7547644.json',mimetype:'application/json',format:'json',content:{tags:['javascript','html'],originalId:'7547644',owner:{id:'sou924821',reputation:428,originalId:'924821',userName:'souser924821@example.com',displayName:'Nitin Kabra'},lastActivityDate:'2011-09-25T19:44:52.887Z',id:'soq7547644',answerCount:2,voteCount:4,accepted:true,downvotingContributorIds:[],creationDate:'2011-09-25T18:31:00.860Z',itemTally:0,upvotingContributorIds:[],title:'Pass variable in document.getElementByid in javascript',acceptedAnswerId:'soa7547693',snippets:[{'match-text':['...:\n\tfunction getElement()\n\t{   \n\t var ',{highlight:'acc'},'_list = document.forms.editBeneficiary.elements...'],source:'question',id:'soq7547644'}]}},{index:2,uri:'/questions/soq22303738.json',path:'fn:doc("/questions/soq22303738.json")',score:107520,confidence:0.5543764,fitness:0.8520157,href:'/v1/documents?uri=%2Fquestions%2Fsoq22303738.json',mimetype:'application/json',format:'json',content:{tags:['javascript'],originalId:'22303738',owner:{id:'sou1712334',reputation:331,originalId:'1712334',userName:'souser1712334@example.com',displayName:'FatalProphet'},lastActivityDate:'2014-03-10T16:03:25.920Z',id:'soq22303738',answerCount:4,voteCount:17,accepted:true,downvotingContributorIds:['unknown'],creationDate:'2014-03-10T15:01:34.677Z',itemTally:3,upvotingContributorIds:['unknown','unknown','unknown','unknown'],title:'Javascript: Passing a math operator as a parameter',acceptedAnswerId:'soa22303786',snippets:[{'match-text':['..., len = list.length;\n\t    var ',{highlight:'acc'},' = arguments.length > 2 ?... ...< len; i++){ ',{highlight:'acc'},' = accumulator...'],source:'answer',id:'soa22303786'}]}},{index:3,uri:'/questions/soq21891002.json',path:'fn:doc("/questions/soq21891002.json")',score:92160,confidence:0.5132529,fitness:0.7888133,href:'/v1/documents?uri=%2Fquestions%2Fsoq21891002.json',mimetype:'application/json',format:'json',content:{tags:['javascript','jquery','html','safari','scroll'],originalId:'21891002',owner:{id:'sou2363',reputation:14546,originalId:'2363',userName:'souser2363@example.com',displayName:'tghw'},lastActivityDate:'2014-03-01T11:10:47.287Z',id:'soq21891002',answerCount:4,voteCount:36,accepted:true,downvotingContributorIds:[],creationDate:'2014-02-19T19:56:14.177Z',itemTally:19,upvotingContributorIds:['unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown','unknown'],title:'Sync scrollbar div to non-scrolled div',acceptedAnswerId:'soa22022640',snippets:[{'match-text':['...CSS property will enable the hardware ',{highlight:'acc'},'.\nIf 3D transforms is supported,... ...',{highlight:'acc'},'... ...',{highlight:'acc'},' /...'],source:'answer',id:'soa22113507'}]}},{index:4,uri:'/questions/soq7538483.json',path:'fn:doc("/questions/soq7538483.json")',score:82944,confidence:0.4869144,fitness:0.748334,href:'/v1/documents?uri=%2Fquestions%2Fsoq7538483.json',mimetype:'application/json',format:'json',content:{tags:['html','css'],originalId:'7538483',owner:{id:'sou130452',reputation:874,originalId:'130452',userName:'souser130452@example.com',displayName:'KuldipMCA'},lastActivityDate:'2013-07-31T15:06:21.333Z',id:'soq7538483',answerCount:3,voteCount:15,accepted:true,downvotingContributorIds:[],creationDate:'2011-09-24T10:38:08.450Z',itemTally:6,upvotingContributorIds:['unknown','unknown','unknown','unknown','unknown','unknown'],title:'How to get list of Css class use in the HTML file?',acceptedAnswerId:'soa7540783',snippets:[{'match-text':['...[].reduce.call(elements, function (',{highlight:'acc'},', e) {\n\t    return e.className... ...reduce(unique, ',{highlight:'acc'},');...'],source:'answer',id:'soa7540783'}]}},{index:5,uri:'/questions/soq14433212.json',path:'fn:doc("/questions/soq14433212.json")',score:58368,confidence:0.4084581,fitness:0.6277553,href:'/v1/documents?uri=%2Fquestions%2Fsoq14433212.json',mimetype:'application/json',format:'json',content:{tags:['javascript','jquery','html'],originalId:'14433212',owner:{id:'sou1687825',reputation:183,originalId:'1687825',userName:'souser1687825@example.com',displayName:'Rishi'},lastActivityDate:'2013-01-21T10:39:49.000Z',id:'soq14433212',answerCount:2,voteCount:9,accepted:true,downvotingContributorIds:[],creationDate:'2013-01-21T06:13:31.083Z',itemTally:3,upvotingContributorIds:['unknown','unknown','unknown'],title:'how to call REST API from javascript',acceptedAnswerId:'soa14433462',snippets:[{'match-text':['...url: \'https://tt.s2.',{highlight:'acc'},'.com/ttm/subscribe-service/uid=sagar...'],source:'answer',id:'soa14436840'}]}}],facets:{date:{type:'bucketed',facetValues:[{name:'2011-09-01T00:00:00-07:00',count:1,value:'2011-09-01T00:00:00-07:00'},{name:'2013-01-01T00:00:00-08:00',count:1,value:'2013-01-01T00:00:00-08:00'},{name:'2013-07-01T00:00:00-07:00',count:1,value:'2013-07-01T00:00:00-07:00'},{name:'2014-03-01T00:00:00-08:00',count:2,value:'2014-03-01T00:00:00-08:00'}]},tag:{type:'xs:string',facetValues:[{name:'html',count:4,value:'html'},{name:'javascript',count:4,value:'javascript'},{name:'jquery',count:2,value:'jquery'},{name:'css',count:1,value:'css'},{name:'safari',count:1,value:'safari'},{name:'scroll',count:1,value:'scroll'}]}},query:{'and-query':[{'field-word-query':[{field:'default-samplestack-search',text:{lang:'en',_value:'acc'}}],'directory-query':[{uri:'/questions/'}],annotation:[{'operator-ref':'sort','state-ref':'relevance'}]}]},qtext:'sort:relevance',report:'(cts:search(fn:collection(), cts:and-query((cts:field-word-query("default-samplestack-search", "acc", ("lang=en"), 1), cts:directory-query("/questions/", "1"), cts:json-property-range-query("voteCount", ">=", -10, ("score-function=linear"), 1)), ()), ("score-logtfidf","faceted",cts:score-order("descending")), 1))[1 to 10]',metrics:{'query-resolution-time':'PT0.04554S','facet-resolution-time':'PT0.043808S','snippet-resolution-time':'PT0.039879S','total-time':'PT0.394596S'}};
      /* jshint ignore:end */

      sandbox.stub(connection.documents, 'query', function(sp) {
        sp.should.deep.equal(docsQuery);
        return {
          result: function() {
            return Promise.resolve(docsQueryResult);
          }
        };
      });

      search(spec).then(function(gtRet) {
        gtRet.should.deep.equal(ret);
        done();
      });

    });

  });
};
